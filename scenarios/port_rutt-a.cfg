#textdomain wesnoth-The_Altaz_Mariners

[scenario]
	id=port_rutt-a
	name="Port Rutt"
	map_data="{~add-ons/The_Altaz_Mariners/maps/port_rutt.map}" 
	random_start_time="no"
	turns=-1  
	experience_modifier=150
	victory_when_enemies_defeated=no
	allow_new_game=no
	force_lock_settings=yes
	{DEFAULT_SCHEDULE}
	{MOOD_CALM}
	
	####################################################################################
	# Side Defintions
	####################################################################################
	
	[side]
		side=1
		canrecruit=yes
		name=Largo
		id=Largo
		save_id=Largo
		controller=human
		team_name=1
		user_team_name= _ "Mariners"
		team_lock=yes
		share_vision=all
		gold=0
		village_gold=0
		income=-2
		type=Thug
		fog=no
		shroud=no
		recruit="Ruffian,Thief,Footpad,Thug,Poacher"
	[/side]

    [side]
		side=2
		canrecruit=yes
		name=Hugo
		id=Hugo
		save_id=Hugo
		controller=human
		team_name=1
		user_team_name= _ "Mariners"
		team_lock=yes
		share_vision=all
		gold=0
		village_gold=0
		income=-2
		type=Poacher
		fog=no
		shroud=no
		recruit="Ruffian,Thief,Footpad,Thug,Poacher"
	[/side]
	
	[side]
		side=3
		controller=ai
		no_leader=yes
		allow_player=no
		team_name=1
		user_team_name= _ "Friends"
		team_lock=yes
		fog=no
		shroud=no
		share_vision=all
	[/side]
	
	[side]
		side=4
		controller=ai
		no_leader=yes
		team_name=2
		user_team_name= _ "Foes"
		team_lock=yes
		allow_player=no
		disallow_observers=yes
	[/side]
	
	####################################################################################
	# Objectives
	####################################################################################

    [event]
    name=prestart
		[if]
			{CONDITION log_marco.alderot not_equals yes}
			[then]
				 [objectives]
					side=0
					[objective]
						description= _ "Speak with Alderot"
						condition=win
					[/objective]
					[objective]
						description= _ "Death of mariners"
						condition=lose
					[/objective]
				[/objectives]
			[/then]
			[else]
				[objectives]
					side=0
					[objective]
						description= _ "Trade, recruit and make merry"
						condition=win
					[/objective]
					[objective]
						description= _ "Death of mariners"
						condition=lose
					[/objective]
				[/objectives]
			[/else]
		[/if]
		{VARIABLE scenario port_rutt}
    [/event]
    
    {PLACE_IMAGE items/gohere.png 27 3}
	[event]
		name=moveto
		[filter]
			x=27
			y=3
			side=1,2
		[/filter]
		[if]
			{CONDITION new_ship not_equals yes}
			[then]
				[remove_item]
					x,y=27,3
				[/remove_item]
				[endlevel]
					result=victory
					continue_no_save=yes
					replay_save=no
					carryover_percentage=100
					carryover_report=no
					bonus=no
					linger_mode=no
					next_scenario=meta-map
				[/endlevel]
			[/then]
		[/if]
	[/event]
	
	[event]
		name=moveto
		first_time_only=no
		[filter]
			x=36
			y=5
			side=1,2
		[/filter]
		[if]
			{CONDITION new_ship equals yes}
			[then]
				[if]
					[have_unit]
						race=ogre
						side=1,2
						[filter_wml]
							[modifications]
								[trait]
									id=follower
								[/trait]
							[/modifications]
						[/filter_wml]
					[/have_unit]
					[then]
						{TAM_STORE_UNITS race=ogre side=1,2 ({VARIABLE stored_units[$i].side 3})}
						[message]
							race=ogre
							side=3
							message=_ "Boss, we not go on ship. We stay here."
						[/message]
						[message]
							speaker=Largo
							message=_ "Why on earth do you want to stay here?"
						[/message]
						[message]
							race=ogre
							side=3
							message=_ "We want home. Ogre ship come here much times, we wait."
						[/message]
						[message]
							speaker=Largo
							message=_ "Very well, I suppose you deserve it. I hope you make it back."
						[/message]
						[message]
							speaker="Ordon"
							message=_ "Ordon sad."
						[/message]
						[message]
							speaker="Mocco"
							message=_ "Mocco too."
						[/message]
						[message]
							speaker=Hugo
							message=_ "Goodbye, friend."
						[/message]
					[/then]
				[/if]
				[remove_item]
					x,y=36,5
				[/remove_item]
				[endlevel]
					result=victory
					continue_no_save=yes
					replay_save=no
					carryover_percentage=100
					carryover_report=no
					bonus=no
					linger_mode=no
					next_scenario=meta-map
				[/endlevel]
			[/then]
		[/if]
	[/event]
	
	[event]
		name=victory
		{CLEAR_VARIABLE new_ship}
	[/event]
	
	####################################################################################
	# Placing Units
	####################################################################################
	
	[event]
    name=prestart
		{TAM_PLACE_FOLLOWERS}
		{TAM_PLACE_LEADER 3 Bandit 26 9 Alderot {TRAIT_AGED}{TRAIT_RESILIENT}}
		[+unit]
			profile=portraits/Alderot.png
		[/unit]
		{TAM_PLACE_NPC 3 Thug 36 6 Grobin}
		{TAM_PLACE_NPC 3 Ruffian 27 6 Fry}
		{TAM_PLACE_NPC 3 Footpad 29 3 Cora}
		{TAM_PLACE_NPC 3 Footpad 20 6 Gundar}
		{TAM_PLACE_NPC 3 Footpad 39 7 Falcon}
		{TAM_PLACE_NPC 3 Poacher 38 11 Hex}
		{TAM_PLACE_NPC 3 Ruffian 23 9 Plaid}
		{TAM_PLACE_UNIT 3 (Ruffian) 35 9}
		{TAM_PLACE_UNIT 3 (Ruffian) 24 4}
		{TAM_PLACE_UNIT 3 (Ruffian) 32 8}
		[if]
			{CONDITION subquest_moira less_than 2}
			{CONDITION hideout equals b}
			[then]
				{TAM_PLACE_NPC 3 Footpad 31 5 Moira}
				[+unit]
					gender=female
				[/unit]
			[/then]
		[/if]
    [/event]
    
	####################################################################################
	# Placing Images
	####################################################################################
	
	{TAM_PLACING_PLAYER_VESSEL 27 2}
	
	[item]
		x,y=37,5
		image=units/ships/dhow.png~TC(3,magenta)
	[/item]
	[item]
		x,y=33,3
		image=units/ships/pirate-ship.png~TC(3,magenta)
	[/item]
	
	####################################################################################
	# Events
	####################################################################################
	
	{TAM_GLOBAL_EVENTS}
	{TAM_TRADING_PORT 26 3 rutt (terrain/village/swampwater.png)}
	{TAM_GAMBLING_DEN 31 7 terrain/village/swampwater2.png}
	{TAM_YEZZA 30 11 32 12}

	##########################################
	# Generic dialogue
	##########################################

	[event]
	name=moveto
		[filter]
            side=1
            canrecruit=yes
            [filter_adjacent]
                id=Plaid
            [/filter_adjacent]
  		[/filter]
		[message]
			speaker=Plaid
			message=_ "One day I'll be a pirate like yourself. But this club just can't bash like yours."
		[/message]
		[message]
			speaker=unit
			message=_ "The more you use a weapon, the more deadly it becomes."
		[/message]
	[/event]
	
	[event]
	name=moveto
		[filter]
            side=1,2
            canrecruit=yes
            [filter_adjacent]
                id=Hex
            [/filter_adjacent]
  		[/filter]
		[message]
			speaker=Hex
			message=_ "Trying to stay in the black? Even though villages yield no gold, they still provide upkeep for your men. Not all of your crew is loyal."
		[/message]
	[/event]

	[event]
	name=moveto
		[filter]
            side=1,2
            canrecruit=yes
            [filter_adjacent]
                id=Cora
            [/filter_adjacent]
  		[/filter]
		[message]
			speaker=Cora
			message=_ "You won't find no royals here. Alderot gets hefty bribes into the right pockets."
		[/message]
	[/event]

	[event]
	name=moveto
		[filter]
            side=1,2
            canrecruit=yes
            [filter_adjacent]
                id=Gundar
            [/filter_adjacent]
  		[/filter]
		[message]
			speaker=Gundar
			message=_ "A good captain always keeps a log of events. Don't forget to check your log when your memory fails you."
		[/message]
	[/event]

	[event]
	name=moveto
		[filter]
            side=1,2
            canrecruit=yes
            [filter_adjacent]
                id=Falcon
            [/filter_adjacent]
  		[/filter]
		[message]
			speaker=Falcon
			message=_ "Men at sea often lose track of time, but time doesn't stop. Whenever your ship runs out of movement, another five days have passed."
		[/message]
	[/event]

	##########################################
	# Moira
	##########################################
	
	[event]
		name=moveto
		[filter]
			side=1,2
			canrecruit=yes
			[filter_adjacent]
				id="Moira"
			[/filter_adjacent]
		[/filter]
		[filter_condition]
			{CONDITION subquest_moira numerical_equals 0}
		[/filter_condition]
		[message]
			speaker=Moira
			message=_ "Howdy boys. Fancy helping a damsel in distress?"
		[/message]
		[message]
			speaker=unit
			message=_ "I see no damsel round here. What do you want?"
		[/message]
		[message]
			speaker=Moira
			message=_ "Charming! Very well, I'll cut to the chase. I'm a cook, of sorts, specialising in rare and potent brews. Used to work out of Fort Bastille, but the royals just busted my place. Took my stuff and turfed me out. General Leo's goons were muttering something about... illegal substances."
		[/message]
		[message]
			speaker=unit
			message=_ "Sounds intriguing. At least they didn't lock you up."
		[/message]
		[message]
			speaker=Moira
			message=_ "True, but I've got nothing now. No shop, no gear, no brew. All I need is somewhere to pitch up, a few bits and pieces and a chance to get working again."
		[/message]
		[if]
			{CONDITION subquest_fry numerical_equals 1}
			[then]
				[message]
					speaker=unit
					message=_ "So you're another hard-up loser like Fry. What do you expect us to do about it?"
				[/message]
			[/then]
			[else]
				[message]
					speaker=unit
					message=_ "What do you expect us to do about it?"
				[/message]
			[/else]
		[/if]
		[message]
			speaker=Moira
			message=_ "To start with I just need a place to set up shop, somewhere quiet where the royals won't come knocking. You look like the travelling type. Seen anywhere that might fit the bill?"
		[/message]
		{VARIABLE subquest_moira 1}
	[/event]
		
	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1,2
			canrecruit=yes
			[filter_adjacent]
				id="Moira"
			[/filter_adjacent]
		[/filter]
		[filter_condition]
			{CONDITION subquest_moira numerical_equals 1}
		[/filter_condition]	
		[message]
			speaker=narrator
			image=wesnoth-icon.png
			message= _ "What will you do?"
			
			# Walk on
			[option]
				description=_ "Walk on"
				[command]
				[/command]
			[/option]
			
			# Suggest a location
			[option]
				description=_ "<span color='{TAM_BLUE}'>Suggest a location</span>"
				[command]
					{VARIABLE question_answered no}
					[while]
						{CONDITION question_answered equals no}
						[do]
							[message]
								speaker=narrator
								caption=_ "Suggest a location..."
								image=wesnoth-icon.png
								message= _ "Type a lowercase answer."
								[text_input]
									variable=temp_answer
									label=_ "Type Here: "
									max_chars=20
								[/text_input]
							[/message]
							[if]
							{CONDITION temp_answer not_equals $empty}
								[then]
									{VARIABLE question_answered yes}
								[/then]
							[/if]
						[/do]
					[/while]

					# Altaz
					[if]
						{CONDITION temp_answer equals "altaz"}
						[or]
							{CONDITION temp_answer equals "gaol"}
						[/or]
						[or]
							{CONDITION temp_answer equals "altaz gaol"}
						[/or]
						[or]
							{CONDITION temp_answer equals "prison island"}
						[/or]
						[or]
							{CONDITION temp_answer equals "altaz jail"}
						[/or]
						[then]
							[message]
								speaker=unit
								message=_ "I hear Altaz Gaol is nice and quiet these days..."
							[/message]
							[message]
								speaker=Moira
								message=_ "Altaz? Are you kidding? A royal prison island ain't exactly the best place to lay low."
							[/message]	
						[/then]
					[/if]
					# Dahazi
					[if]
						{CONDITION temp_answer equals "dahazi"}
						[or]
							{CONDITION temp_answer equals "dahazi beach"}
						[/or]
						[then]
							[message]
								speaker=unit
								message=_ "Have you considered working out of Dahazi Beach?"
							[/message]
							[message]
								speaker=Moira
								message=_ "Nah, them lizards give me the creeps. I need somewhere where I can work undisturbed."
							[/message]	
						[/then]
					[/if]
					# Judro
					[if]
						{CONDITION temp_answer equals "judro"}
						[or]
							{CONDITION temp_answer equals "judro pits"}
						[/or]
						[then]
							[message]
								speaker=unit
								message=_ "Have you thought about heading to Judro Pits?"
							[/message]
							[message]
								speaker=Moira
								message=_ "You're a fool if you think Judro is a safe place for a women and her cauldron."
							[/message]	
						[/then]
					[/if]
					# Elixion
					[if]
						{CONDITION temp_answer equals "elixion"}
						[then]
							[message]
								speaker=unit
								message=_ "How about setting up shop at Elixion?"
							[/message]
							[message]
								speaker=Moira
								message=_ "Something tells me the elves there won't approve. Any other ideas?"
							[/message]	
						[/then]
					[/if]
					# Fort Bastille
					[if]
						{CONDITION temp_answer equals "fort bastille"}
						[then]
							[message]
								speaker=unit
								message=_ "What about Fort Bastille?"
							[/message]
							[message]
								speaker=Moira
								message=_ "You're even dumber than you look. I'm asking you because I need to go somewhere else."
							[/message]	
						[/then]
					[/if]
					# Port Rutt
					[if]
						{CONDITION temp_answer equals "port rutt"}
						[then]
							[message]
								speaker=unit
								message=_ "What about right here?"
							[/message]
							[message]
								speaker=Moira
								message=_ "I learned my lesson at Fort Bastille. I need somewhere out of the way."
							[/message]	
						[/then]
					[/if]
					# Farrow
					[if]
						{CONDITION temp_answer equals "farrow"}
						[then]
							[message]
								speaker=unit
								message=_ "What about Farrow?"
							[/message]
							[message]
								speaker=Moira
								message=_ "I don't trust the fool in charge of that place."
							[/message]	
						[/then]
					[/if]
					# Farmville
					[if]
						{CONDITION temp_answer equals "farmville"}
						{CONDITION farmville equals a}
						[then]
							[message]
								speaker=unit
								message=_ "Why don't you pitch up at Farmville?"
							[/message]
							[message]
								speaker=Moira
								message=_ "Move in with a gang of lonely farm boys? No thanks."
							[/message]	
						[/then]
					[/if]
					[if]
						{CONDITION temp_answer equals "farmville"}
						{CONDITION farmville equals b}
						[then]
							[message]
								speaker=unit
								message=_ "There's not much going on at Farmville, so I'm told."
							[/message]
							[message]
								speaker=Moira
								message=_ "I heard some disease wiped out Old Man Tet and the others. I'm not risking it."
							[/message]
							[message]
								speaker=unit
								message=_ "Who told you that? Hmm, well... nevermind."
							[/message]
						[/then]
					[/if]
					
					# Everything else
					[if]
						{CONDITION temp_answer not_equals "altaz"}
						{CONDITION temp_answer not_equals "gaol"}
						{CONDITION temp_answer not_equals "altaz gaol"}
						{CONDITION temp_answer not_equals "prison island"}
						{CONDITION temp_answer not_equals "altaz jail"}
						{CONDITION temp_answer not_equals "dahazi"}
						{CONDITION temp_answer not_equals "dahazi beach"}
						{CONDITION temp_answer not_equals "judro"}
						{CONDITION temp_answer not_equals "judro pits"}
						{CONDITION temp_answer not_equals "elixion"}
						{CONDITION temp_answer not_equals "fort bastille"}
						{CONDITION temp_answer not_equals "port rutt"}
						{CONDITION temp_answer not_equals "farrow"}
						{CONDITION temp_answer not_equals "hideout"}
						{CONDITION temp_answer not_equals "hide out"}
						{CONDITION temp_answer not_equals "the hideout"}
						{CONDITION temp_answer not_equals "the hide out"}
						{CONDITION temp_answer not_equals "farmville"}
						[then]
							[message]
								speaker=unit
								message=_ "What about $temp_answer|?"
							[/message]
							[message]
								speaker=Moira
								message=_ "Nah, I don't think that's suitable. Got any other ideas?"
							[/message]	
						[/then]
					[/if]
					
					# Hideout
					[if]
						{CONDITION temp_answer equals "hideout"}
						[or]
							{CONDITION temp_answer equals "hide out"}
						[/or]
						[or]
							{CONDITION temp_answer equals "the hideout"}
						[/or]
						[or]
							{CONDITION temp_answer equals "the hide out"}
						[/or]
						[then]
							[message]
								speaker=unit
								message=_ "There's always our hideout, it's pretty secluded."
							[/message]
							[message]
								speaker=Moira
								message=_ "Hmm... where is that?"
							[/message]
							[message]
								speaker=unit
								message=_ "It's not too far and we're the only ones who know about it. I guess we don't really need it right now."
							[/message]
							[message]
								speaker=Moira
								message=_ "Sounds good to me. Mark it on my map and I'll be on my way."
							[/message]
							[message]
								speaker=unit
								message=_ "Fine, here you go. Happy brewing!"
							[/message]
							{VARIABLE subquest_moira 2}
						[/then]
					[/if]
					
					{CLEAR_VARIABLE temp_answer}
				[/command]
			[/option]		
		[/message]			
	[/event]
	
	##########################################
	# Fry
	##########################################
	
	[event]
		name=moveto
		[filter]
            side=1,2
            canrecruit=yes
            [filter_adjacent]
                id=Fry
            [/filter_adjacent]
        [/filter]
     
		# If the players donated enough gold
		[if]
			{CONDITION subquest_fry numerical_equals 2}
			[then]
				[message]
					speaker=Fry
					message=_ "Hello there! Do you remember me? I certainly remember you. Those coins you gave me served me well over at the gamblin' den. Though you gave it me in pity, it was enough to turn my fortunes around."
				[/message]
				[message]
					speaker=unit
					message=_ "I'm glad to hear it Fry."
				[/message]
				[message]
					speaker=Fry
					message=_ "I don't know what I would have done if you hadn't dropped by and helped me out. I was at rock bottom. Now I'm... well, I'm doing okay. In fact, I'd like to give you forty coins as a gesture of thanks."
				[/message]
				[message]
					speaker=unit
					message=_ "I shan't say no to such a gesture. I hope your fortunes stay afloat."
				[/message]
				{VARIABLE subquest_fry 3}
				{TAM_GOLD $side_number 40}
				{PLAY_SOUND gold.ogg}
				[floating_text]
					x,y=$x1,$y1
					text="<span color='{TAM_GOLDEN}'>" + _ "float^40g" + "</span>"
				[/floating_text]
			[/then]
		[/if]
		
		# If the players did not donate enough gold the first time
		[if]
			{CONDITION subquest_fry numerical_equals 1}
			[then]
				[message]
					speaker=Fry
					message=_ "Why, it's my old friends! Spare some more gold, perchance?"
				[/message]
			[/then]
		[/if]
		
		# If the players have not given Fry anything before
        [if]
			{CONDITION subquest_fry numerical_equals 0}
			[then]
				[message]
					speaker=Fry
					message=_ "Hey there. Can you spare some gold for a poor sot whose lot is nowt?"
				[/message]
				[message]
					speaker=unit
					message=_ "We are not in the habit of flinging coins at every beggar who accosts us."
				[/message]
				[message]
					speaker=Fry
					message=_ "This beggar might just know somethin' that'll make it worth your while. Please, a few gold is all I ask..."
				[/message]
			[/then]
		[/if]
		
		# Donating
		[if]
			{CONDITION subquest_fry less_than 2}
			[then]
				[store_side]
					side=$side_number
					variable=donator
				[/store_side]
				[message]
					speaker=narrator
					image=wesnoth-icon.png
					message= _ "What will you do?"
					
					# Walk on
					[option]
						message=_ "Walk on"
						[command]
							[message]
								speaker=unit
								message=_ "Harass another, you vagrant."
							[/message]
						[/command]
					[/option]
					
					# Give him some gold
					[option]
						message=_ "<span color='{TAM_BLUE}'>Give him some gold</span>"
						[show_if]
							{CONDITION donator.gold greater_than_equal_to 1}
						[/show_if]
						[command]
							{VARIABLE giving_finished no}
							[while]
								{CONDITION giving_finished equals no}
								[do]
									[message]
										speaker=narrator
										image=wesnoth-icon.png
										message= _ "How much gold will you give?"
										[text_input]
											label= _ "Amount: "
											max_chars=4
											text=_ "0"
											variable=donation
										[/text_input]
									[/message]
									[if]
										{CONDITION donator.gold greater_than_equal_to $donation}
										{CONDITION donation numerical_equals $donation}
										{CONDITION donation greater_than 0}
										[then]
											{TAM_GOLD $side_number -$donation}
											{VARIABLE subquest_fry 1}
											[message]
												speaker=unit
												message=_ "Here, $donation coins is surely enough to be rid of you."
											[/message]
											[if]
											{CONDITION farmville equals a}
												[then]
													[message]
														speaker=Fry
														message=_ "Alrighty, now listen up mates. See that pirate ship there? It's bound for Farmville it is, a backwards hole not far from here. Them farmers be expecting a pickup, but the captain's got dead drunk last night - and got in trouble with Alderot an' all."
													[/message]
													[message]
														speaker=unit
														message=_ "Cut to the chase, Fry."
													[/message]
													[message]
														speaker=Fry
														message=_ "Don't ya see? That ship ain't going nowhere for a couple o' days. And all the while them Farmville fools be sitting on a pile of gold. Get me? I woulda made a good old pirate if I had a ship of me own."
													[/message]
													[message]
														speaker=unit
														message=_ "Hmm, thanks for the tip."
													[/message]
												[/then]
											[/if]
											[if]
											{CONDITION farmville not_equals a}
												[then]
													[message]
														speaker=Fry
														message=_ "I'll tell you something that'll save your skin, alright."
													[/message]
													[message]
														speaker=unit
														message=_ "What is it, Fry?"
													[/message]
													[message]
														speaker=Fry
														message=_ "Stay away from that there gambling hall. It'll ruin you it will, like it ruined me."
													[/message]
													[message]
														speaker=unit
														message=_ "You're a fool."
													[/message]
												[/then]
											[/if]
											{VARIABLE giving_finished yes}
											{RANDOM 1..20}
											[if]
												{CONDITION donation greater_than_equal_to $random}
												[then]
													{VARIABLE subquest_fry 2}
												[/then]
											[/if]
											{CLEAR_VARIABLE random}
											{CLEAR_VARIABLE donation}
										[/then]
									[/if]
								[/do]
							[/while]
						[/command]
					[/option]
					
				[/message]
				{CLEAR_VARIABLE donator}
			[/then]
		[/if]

	[/event]
		
	##########################################
	# Alderot
	##########################################
	
	[event]
		name=moveto
		[filter]
            side=1,2
            canrecruit=yes
            [filter_adjacent]
                id="Alderot"
            [/filter_adjacent]
        [/filter]
        
		# If they visit Alderot before GT80
        [if]
			{CONDITION global_turns less_than_equal_to 80}
			{CONDITION log_debts.alderot not_equals yes}
			[then]
				[message]
					speaker=Alderot
					message=_ "$unit.id|! Didn't think I'd be catching a whiff of you any time soon, welcome back!"
				[/message]
				[message]
					speaker=unit
					message=_ "Hello old friend. The news of our escape will soon precede us, thus we cannot tarry."
				[/message]
			[/then]
		[/if]
		
		# If they visit Alderot after GT80
		[if]
			{CONDITION global_turns greater_than 80}
			{CONDITION log_debts.alderot not_equals yes}
			[then]
				[message]
					id=Alderot
					message=_ "Much as it joys me to see you free men again, I must warn it might not be safe for you here anymore. The royals came looking for you."
				[/message]
				[message]
					speaker=unit
					message=_ "It's okay, Alderot. We'll soon be on our way."
				[/message]
			[/then]
		[/if]
		
		# If they owe Alderot gold
		[if]
			{CONDITION log_debts.alderot equals yes}
			[then]
				[message]
					id=Alderot
					message=_ "How is my beggar friend today?"
				[/message]
				[message]
					speaker=unit
					message=_ "Could be worse."
				[/message]
				[message]
					id=Alderot
					message=_ "I'm sure it could. Listen, you owe me forty gold pieces. Where is it?"
				[/message]
			[/then]
		[/if]
	[/event]
		
	[event]
	name=moveto
	first_time_only=no
		[filter]
            side=1,2
            canrecruit=yes
            [filter_adjacent]
                id="Alderot"
            [/filter_adjacent]
        [/filter]
        
        [store_side]
			side=1
			variable=side_1
		[/store_side]
		[store_side]
			side=2
			variable=side_2
		[/store_side]
		[store_side]
			side=$side_number
			variable=current_side
		[/store_side]
		
		[message]
			speaker=narrator
			image=wesnoth-icon.png
			message= _ "What will you do?"
			# Walk on
			[option]
				message=_ "Walk on"
				[command]
				[/command]
			[/option]
			# Ask about Marco
			[option]
				message=_ "<span color='{TAM_BLUE}'>Ask what he knows of Marco</span>"
				[show_if]
					{CONDITION log_debts.alderot not_equals yes}
					{CONDITION avalon equals z}
				[/show_if]
				[command]
					[message]
						speaker=unit
						message=_ "Alderot, what became of Marco after our capture? We've a mind to pay him a visit."
					[/message]
					[message]
						id=Alderot
						message=_ "Of course you are! Marco must have known that gaol would not hold you long. He took off soon after they took you. Damn scoundrel. They say he sailed south, though the tales differ as to his destination. All that is certain is that he didn't dare return to these waters."
					[/message]
					[message]
						speaker=unit
						message=_ "Thank you. It is enough to go on, for now."
					[/message]
					[if]
					{CONDITION ship_type equals TAM_Cutter}
						[then]
							[message]
								speaker=unit
								message=_ "But first we must find a vessel worthy of the journey."
							[/message]
							[message]
								id=Alderot
								message=_ "Well, speak to Grobin over at the docks. I hear he's got a ship to sell."
							[/message]
						[/then]
					[/if]
					{VARIABLE log_marco.alderot yes}
					{VARIABLE log_ship.alderot yes}
				[/command]
			[/option]
			# Ask about Yezza
			[option]
				message=_ "<span color='{TAM_BLUE}'>Ask what he knows of Yezza</span>"
				[show_if]
					{CONDITION subquest_yezza greater_than_equal_to 1}
				[/show_if]
				[command]
					[message]
						speaker=unit
						message=_ "You remember that idiot pirate Yezza, don't you? What's he up to?"
					[/message]
					[message]
						speaker=Alderot
						message=_ "Old Yezza is a nuisance, but he's harmless enough. Spends his time between here and Greystone, or thereabouts. Seems the only way you'll earn his respect is with a good yarn. I don't need to tell you that his aren't the truest you'll hear. Strange thing is, I think he actually believes half of them."
					[/message]
				[/command]
			[/option]
			[option]
				message=_ "<span color='{TAM_BLUE}'>Ask after Yezza</span>"
				[show_if]
					{CONDITION subquest_yezza numerical_equals 4}
				[/show_if]
				[command]
					[message]
						speaker=unit
						message=_ "Seen Yezza round these parts?"
					[/message]
					[message]
						speaker=Alderot
						message=_ "I heard you bested him with your bragging. Fair play to you! I've not seen him around for a while."
					[/message]
				[/command]
			[/option]
			# Ask about Moira
			[option]
				message=_ "<span color='{TAM_BLUE}'>Ask about Moira</span>"
				[show_if]
					{CONDITION subquest_moira greater_than_equal_to 1}
					{CONDITION subquest_moira less_than_equal_to 3}
				[/show_if]
				[command]
					[message]
						speaker=unit
						message=_ "What do you make of Moira?"
					[/message]
					[message]
						speaker=Alderot
						message=_ "She's a good sort, though I'd watch yourself if she offers you any of those brews of hers."
					[/message]
				[/command]
			[/option]
			# Ask for advice
			[option]
				message=_ "<span color='{TAM_BLUE}'>Ask for advice</span>"
				[show_if]
					{CONDITION global_turns less_than_equal_to 120}
				[/show_if]
				[command]
					[message]
						speaker=unit
						message=_ "What do you think we should do, Alderot?"
					[/message]
					[message]
						speaker=Alderot
						message=_ "Well, you're handy in a scrap, you've proved that much. But you'll have to use yer wits too. It's worth approaching strangers just to see what they have to say. And sometimes you might want to check back with folk in case they've heard anything new."
					[/message]
				[/command]
			[/option]
			# Ask about The Black Blade
			[option]
				message=_ "<span color='{TAM_BLUE}'>Ask what he knows about the Black Blade</span>"
				[show_if]
					{CONDITION subquest_blade greater_than_equal_to 2}
				[/show_if]
				[command]
					[message]
						speaker=unit
						message=_ "Alderot, what do you know of the Black Blade?"
					[/message]
					[message]
						id=Alderot
						message=_ "Ha! You boys like getting in trouble, don't ya?"
					[/message]
					[message]
						speaker=unit
						message=_ "So you've heard of it?"
					[/message]
					[message]
						id=Alderot
						message=_ "Aye, I know about them shady types. Don't get me wrong - any enemy of Tylon must have their heart in the right place."
					[/message]
					[message]
						id=Alderot
						message=_ "But as far as I can see, the blade is all talk. They've not done nothing that's done anyone any good."
					[/message]
					[if]
					{CONDITION subquest_blade less_than 7}
						[then]
							[message]
								speaker=unit
								message=_ "Do you where they are based?"
							[/message]
							[message]
								id=Alderot
								message=_ "People say it's in the north west, but nobody's quite sure. They keep themselves well hidden."
							[/message]
							{VARIABLE log_blade.location_rumour yes}
						[/then]
					[/if]
					 
					[if]
					{CONDITION fort_liberty equals b}
						[then]
							[message]
								speaker=unit
								message=_ "Well, that's about to change."
							[/message]
							[message]
								id=Alderot
								message=_ "I'm not sure I want to know what you mean by that."
							[/message]
						[/then]
					[/if]
				[/command]
			[/option]
			
			# Other News
			[option]
				message=_ "<span color='{TAM_BLUE}'>Enquire about other news</span>"
				[show_if]
					{CONDITION dahazi_beach equals z}
					{CONDITION judro_pits equals z}
					#{CONDITION log_debts.alderot not_equals yes}
				[/show_if]
				[command]
					[message]
						speaker=unit
						message=_ "What else has been happening in these parts, Alderot?"
					[/message]
					[message]
						id=Alderot
						message=_ "Besides your daring escape from Altaz? Let me think... Hilldon took over your racket, some of your men work for him now. But he ain't a patch on you two."
					[/message]
					[if]
						{CONDITION hideout equals b}
						[then]
							[message]
								speaker=unit
								message=_ "Aye, we ran into him already. He ducked out before we could get our hands on him."
							[/message]
						[/then]
						[else]
							[message]
								speaker=unit
								message=_ "Aye, we should've known that fool would step forward to fill our boots."
							[/message]
						[/else]
					[/if]
					{VARIABLE log_hilldon.alderot yes}
					[message]
						id=Alderot
						message=_ "Sounds to me like you're keen to get back in the action! Well, I've been hearing some mighty interesting rumours of late. Seems one of King Tylon's lordlings has been strutting his feathers a little too proud and has stirred up a whole heap of trouble. Some say there's rebellion in the air..."
					[/message]
					[message]
						id=Alderot
						message=_ "There's unrest brewing among the workers at Dahazi Beach. Uden can't keep those lizardmen under the kosh forever. Might be worth helping out if you be wanting a look-in on the spices."
					[/message]
					[message]
						id=Alderot
						message=_ "Also, my people tell me there's been some cage-rattling down at Judro Pits. It's where the royals turn felons into fighters, so there's plenty of drywood there waiting for a spark."
					[/message]
					[message]
						id=Alderot
						message=_ "Mind you, you can't stick your oar into every passing wave. Pirates have to pick their battles, you know? Here, I'll mark both places on yer map. Just in case you happen to be passing by..."
					[/message]
					{TAM_LOCATION_ADDED}
					{VARIABLE dahazi_beach a}
					{VARIABLE judro_pits a}
				[/command]
			[/option]
			
			# Ask him to join you (pre-war)
			[option]
				message=_ "<span color='{TAM_BLUE}'>Ask if he will join you</span>"
				[show_if]
					{CONDITION log_debts.alderot not_equals yes}
					{CONDITION fort_liberty equals z}
				[/show_if]
				[command]
					[message]
						speaker=unit
						message=_ "Fancy cutting loose from this place, Alderot? We could do with a sailor like you. The gold will be stacked up soon enough."
					[/message]
					[message]
						id=Alderot
						message=_ "You're wanted men now, fellas. I'm happy right here. This place needs a strong arm to keep it in check. If it's crew you're after, you'll have more luck up in the encampment keep. Look for the tent on the fort, that's where you'll find recruits."
					[/message]
				[/command]
			[/option]
			# Ask him to join you (war)
			[option]
				message=_ "<span color='{TAM_BLUE}'>Ask if he will join you</span>"
				[show_if]
					{CONDITION log_debts.alderot not_equals yes}
					{CONDITION fort_liberty not_equals z}
				[/show_if]
				[command]
					[message]
						speaker=unit
						message=_ "Listen up, Alderot. We're attacking Fort Liberty and we need all the help we can get. Are you in?"
					[/message]
					[message]
						id=Alderot
						message=_ "Ha! Nice one, $unit.name|."
					[/message]
				[/command]
			[/option]
			
			# Ask about the storm
			[option]
				message=_ "<span color='{TAM_BLUE}'>Ask about the storm</span>"
				[show_if]
					{CONDITION log_storm.seen equals yes}
					{CONDITION log_storm.rumour not_equals yes}
				[/show_if]
				[command]
					[message]
						speaker=unit
						message=_ "Alderot, we ran into a huge storm down south. Miles across it was. Heard anything about it?"
					[/message]
					[message]
						id=Alderot
						message=_ "That's certainly news to me. Don't get out on the waves as much as I used to. The sailors at Fort Bastille or Greystone must have come across it too. You should try there if you're after some navigation pointers. I'm ashamed to say it, but I'm pretty much a landlubber these days."
					[/message]
				[/command]
			[/option]
			
			# Ask for a loan
			[option]
				message=_ "<span color='{TAM_BLUE}'>Ask for a loan</span>"
				[show_if]
					{CONDITION log_debts.alderot not_equals yes}
				[/show_if]
				[command]
					[if]
						{CONDITION side_1.gold less_than 30}
						{CONDITION side_2.gold less_than 30}
						{CONDITION rum numerical_equals 0}
						{CONDITION jewels numerical_equals 0}
						{CONDITION spices numerical_equals 0}
						{CONDITION rum_hideout.stash numerical_equals 0}
						{CONDITION jewels_hideout.stash numerical_equals 0}
						{CONDITION spices_hideout.stash numerical_equals 0}
						{CONDITION global_turns greater_than 40}
						[then]
							[message]
								speaker=unit
								message=_ "Alderot, we're strapped and desperate. Any chance you could sort us out some gold?"
							[/message]
							[message]
								id=Alderot
								message=_ "You can't get into the habit of coming to me every time you're in a scrape. I thought you were pirates, not beggars..."
							[/message]
							[message]
								speaker=unit
								message=_ "Hey, we'll pay it back. You're the one sod in this land we can trust."
							[/message]
							[message]
								id=Alderot
								message=_ "Hmm, it is against my better judgement, but okay. Here's forty pieces. If I see you down the gambling hall tonight - I shan't be happy!"
							[/message]
							[message]
								speaker=unit
								message=_ "Thanks Alderot! This will save our skins for sure."
							[/message]
							{VARIABLE log_debts.alderot yes}
							{TAM_GOLD $side_number 40}
							{PLAY_SOUND gold.ogg}
							[floating_text]
								x,y=$x1,$y1
								text="<span color='{TAM_GOLDEN}'>" + _ "float^40g" + "</span>"
							[/floating_text]
						[/then]
						[else]
							[message]
								speaker=unit
								message=_ "Alderot, any chance you could lend us some gold?"
							[/message]
							[message]
								id=Alderot
								message=_ "No chance. I'd always help out a friend, but you're probably better off than most of the folk on this island."
							[/message]
						[/else]
					[/if]
				[/command]
			[/option]
			# Offer to repay the loan
			[option]
				message=_ "<span color='{TAM_BLUE}'>Offer to pay your debt</span>"
				[show_if]
					{CONDITION log_debts.alderot equals yes}
					{CONDITION current_side.gold greater_than_equal_to 40}
					{CONDITION ship_type not_equals TAM_Cutter}
				[/show_if]
				[command]
					[message]
						speaker=unit
						message=_ "I've got your gold here, Alderot. Thanks again for helping us out."
					[/message]
					[message]
						id=Alderot
						message=_ "Didn't expect to see that again! You're a good man, $unit.name|."
					[/message]
					{TAM_GOLD $side_number -40}
					{VARIABLE log_debts.alderot no}
				[/command]
			[/option]
			# Pretend to be poor
			[option]
				message=_ "<span color='{TAM_BLUE}'>Pretend to be poor</span>"
				[show_if]
					{CONDITION log_debts.alderot equals yes}
					{CONDITION current_side.gold greater_than_equal_to 40}
				[/show_if]
				[command]
					[message]
						speaker=unit
						message=_ "Sorry, old chum. My pockets are all but empty right now."
					[/message]
					[message]
						id=Alderot
						message=_ "Well, what are you doing hanging round here? You should be off filling them with plunder."
					[/message]
				[/command]
			[/option]
		[/message]
		
	[/event]	
	
	##########################################
	# Grobin
	##########################################
	
	# If they've already bought the dhow
	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1,2
			canrecruit=yes
			[filter_adjacent]
				id="Grobin"
			[/filter_adjacent]
		[/filter]
		[filter_condition]
			{CONDITION ship_type equals TAM_Dhow}
			{CONDITION new_ship not_equals yes}
		[/filter_condition]
		[message]
			id=Grobin
			message=_ "That boat of yours holding up?"
		[/message]
		[message]
			speaker=unit
			message=_ "You're a honest merchant, Grobin. It's a fine vessel."
		[/message]
		[message]
			speaker=narrator
			image=wesnoth-icon.png
			message= _ "What will you do?"
			# Walk on
			[option]
				message=_ "Walk on"
				[command]
					[message]
						speaker=unit
						message=_ "Good day to you."
					[/message]
				[/command]
			[/option]
			# Enquire
			[option]
				message=_ "<span color='{TAM_BLUE}'>Enquire about buying another ship</span>"
				[command]
					[message]
						speaker=unit
						message=_ "Tell me, Grobin. Do you have any larger ships for sale?"
					[/message]
					[message]
						id=Grobin
						message=_ "Outgrown your sails, have ye?"
					[/message]
					[message]
						speaker=unit
						message=_ "Well, we're planning to travel far. A bigger boat would be a wise purchase."
					[/message]
					[message]
						id=Grobin
						message=_ "If you be wanting a galleon of your own, I can't help you. You're best off trying the shipyards at Fort Bastille."
					[/message]
					[message]
						speaker=unit
						message=_ "Thank you and farewell."
					[/message]
				[/command]
			[/option]
		[/message]	
	[/event]
	
	# If they've don't have the dhow - first time
	[event]
		name=moveto
		[filter]
			side=1,2
			canrecruit=yes
			[filter_adjacent]
				id="Grobin"
			[/filter_adjacent]
		[/filter]
		[filter_condition]
			{CONDITION ship_type equals TAM_Cutter}
		[/filter_condition]
		[message]
			id=Grobin
			message=_ "'Allo there. Grobin's the name. You must be wanting a new ship, yes?"
		[/message]
		[message]
			speaker=unit
			message=_ "Aye. We're looking for a vessel fit for the storms and gales of the open sea."
		[/message]
		[message]
			id=Grobin
			message=_ "Then you've come to the right man. I got a dhow that'll take you across the open sea. Whatsmore, it'll get you back again."
		[/message]
		[message]
			speaker=unit
			message=_ "And how much are you asking for such a boat?"
		[/message]
		[message]
			id=Grobin
			message=_ "Hmm. For you my friend, I charge only a hundred gold pieces. Do we have a deal?"
		[/message]
		{VARIABLE log_ship.grobin yes}
		# Nested event for ogre hint
		[event]
		name=moveto
			[filter]
				race=ogre
				side=1,2
				[filter_wml]
					[modifications]
						[trait]
							id=follower
						[/trait]
					[/modifications]
				[/filter_wml]
			[/filter]
			[message]
				race=ogre
				message=_ "One day we go home on boat... But now we ready to fight more."
			[/message]
		[/event]
	[/event]	
		
	# If they've don't have the dhow - thereafter
	[event]
		name=moveto
		first_time_only=no
		[filter]
			side=1,2
			canrecruit=yes
			[filter_adjacent]
				id="Grobin"
			[/filter_adjacent]
		[/filter]
		[filter_condition]
			{CONDITION ship_type equals TAM_Cutter}
		[/filter_condition]

		[store_side]
			side=$side_number
			variable=shopper
		[/store_side]
	
		[message]
			speaker=narrator
			image=wesnoth-icon.png
			message= _ "What will you do?"
			# Walk on
			[option]
				message=_ "Walk on"
				[command]
				[/command]
			[/option]
			# Decline
			[option]
				message=_ "<span color='{TAM_BLUE}'>Decline the offer</span>"
				[command]
					[message]
						speaker=unit
						message=_ "Not today, Grobin. I may return when the gold is ready."
					[/message]
				[/command]
			[/option]
			# Accept
			[option]
				message=_ "<span color='{TAM_BLUE}'>Purchase the dhow</span>"
				[show_if]
					{CONDITION shopper.gold greater_than_equal_to 100}
				[/show_if]
				[command]
					{TAM_GOLD $side_number -100}
					[message]
						speaker=unit
						message=_ "Yes, we have a deal. Here's the gold. This boat better be worth the fee."
					[/message]
					[message]
						id=Grobin
						message=_ "Very good. You'll be happy with that beauty for sure. I've left the old figurehead intact, you can have that for free."
					[/message]
					{VARIABLE figurehead_infantryman yes}
					[message]
						speaker=narrator
						image=wesnoth-icon.png
						message= _ "What will you christen your new ship?"
						[text_input]
							variable=ship_name
							label=_ "Type Here: "
							max_chars=50
						[/text_input]
					[/message]
					[message]
						speaker=unit
						message=_ "I christen this ship $ship_name|. May it fare us well!"
					[/message]
					{VARIABLE ship_type TAM_Dhow}
					{VARIABLE rum_max 3}
					{VARIABLE jewels_max 3}
					{VARIABLE spices_max 3}
					{VARIABLE new_ship yes}
					[remove_item]
						x,y=37,5
					[/remove_item]
					[item]
						x,y=37,5
						image=units/ships/dhow.png~TC(1,magenta)
					[/item]
					[remove_item]
						x,y=27,3
					[/remove_item]
					{TAM_EXIT 36 5}
					{HIGHLIGHT_IMAGE 36 5 items/gohere.png misc/blank-hex.png}
				[/command]
			[/option]
			
		[/message]
	[/event]
	
[/scenario]