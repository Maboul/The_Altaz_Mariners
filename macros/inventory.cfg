#textdomain wesnoth-The_Altaz_Mariners

####################################################################################
# Inventory
####################################################################################

# Max number of items shown on the screen without scrollbar: 13

#define TAM_INVENTORY
[set_menu_item]
	id=Inventory
	description=_ "Inventory"
	image=misc/inventory-icon.png
	[show_if]
		[have_unit]
			side=$side_number
			canrecruit=yes
			x,y=$x1,$y1
			[not]
				[filter_wml]
					[status]
						petrified=yes
					[/status]
				[/filter_wml]
			[/not]
		[/have_unit]
	[/show_if]
	[command]
{VARIABLE finished no}
[while]
{CONDITION finished equals no}
[do]
[message]
	speaker=narrator
	image=misc/backpack.png
	caption=_ "Inventory"
	message= _ "Items in the inventory are shared between players. Select an item to use it."

[option]
image=misc/blank-icon.png
label=" "
description= _"Return To Game"
[command]
{VARIABLE finished yes}
[/command]
[/option]

####################################################################################
# Misc Items
####################################################################################

#####################
# Flints
#####################

[option]
image=inventory/rocks.png
label="x$inventory.flints"
description= "<span color='{TAM_BLUE}'>" + _ "Flints" + "</span>"
[show_if]
	{CONDITION inventory.flints greater_than_equal_to 1}
	[/show_if]
[command]
	# If players try using flints on the wrong hex
	[if]
		{CONDITION scenario equals gaol-a}
		[have_unit]
			side=$side_number
			canrecruit=yes
			[not]
				x=13
				y=14
			[/not]
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "The flints do nothing here. Let's try using them on something else."
			[/message]
		[/then]
	[/if]
	# If players use flints on the brazier
	[if]
		{CONDITION scenario equals gaol-a}
		[have_unit]
			x=13
			y=14
			side=$side_number
			canrecruit=yes
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "Let's see if the flints will light these leaves."
			[/message]
			[remove_item]
				x=$x1
				y=$y1
			[/remove_item]
			{PLAY_SOUND torch.ogg}
			{MODIFY_TERRAIN Urb^Zbl $x1 $y1}
			{TAM_REDRAW}
			{VARIABLE subquest_cell 1}
			{CLEAR_VARIABLE inventory.flints}
			[message]
				speaker=unit
				message=_ "Aha!"
			[/message]
			[message]
				speaker=Hugo
				message=_ "At least it's warmer now I suppose."
			[/message]
		[/then]
	[/if]
[/command]
[/option]

#####################
# Boulders
#####################

[option]
image=inventory/rocks.png
label="x$inventory.boulders"
description= "<span color='{TAM_BLUE}'>" + _ "Boulders" + "</span>"
[show_if]
	{CONDITION inventory.boulders greater_than_equal_to 1}
[/show_if]
[command]
	# If players use boulders on the collapsed hex
	[if]
		[have_unit]
			x=30
			y=4
			side=$side_number
			canrecruit=yes
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "With a bit of luck we can block up the torrent with these boulders."
			[/message]
			[remove_item]
				x=$x1
				y=$y1
			[/remove_item]
			{PLAY_SOUND water-blast.wav}
			{MODIFY_TERRAIN Wwf^Dr $x1 $y1}
			{TAM_REDRAW}
			{CLEAR_VARIABLE inventory.boulders}
			[message]
				speaker=unit
				message=_ "Hmm, the water is still gushing through the gaps."
			[/message]
		[/then]
	[/if]
[/command]
[/option]

#####################
# Shrooms
#####################

[option]
image=inventory/shrooms.png
label="x$inventory.shrooms"
description= "<span color='{TAM_BLUE}'>" + _ "Magic Mushrooms" + "</span>"
[show_if]
	{CONDITION inventory.shrooms greater_than_equal_to 1}
[/show_if]
[command]
	[message]
		speaker=unit
		message=_ "Wanna try eating a shroom? Nah, me neither."
	[/message]
[/command]
[/option]

#####################
# Brews
#####################

# Healing
[option]
image=inventory/brew-red.png
label="x$inventory.brew_red"
description= "<span color='{TAM_BLUE}'>" + _ "Red Brew" + "</span>"
[show_if]
	{CONDITION inventory.brew_red greater_than_equal_to 1}
[/show_if]
[command]
	[if]
		[have_unit]
			x,y=$x1,$y1
			[not]
				[filter_wml]
					hitpoints=$this_unit.max_hitpoints
				[/filter_wml]
			[/not]
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			{PLAY_SOUND potion.ogg}
			[delay]
				time=3000
			[/delay]
			{PLAY_SOUND magic-missile-3.ogg}
			[item]
				x,y=$x1,$y1
				halo="halo/brew-red-[1,2,3,2].png:100,halo/brew-red-[3,4,5,4].png:150,halo/brew-red-[5,6,7,6,7].png:100"
			[/item]
			[delay]
				time=1500
			[/delay]
			{FLASH_RED ({PLAY_SOUND shrink.wav})}
			# Need to reinstate the screen colour in the furnace
			[if]
				{CONDITION scenario equals furnace}
				[then]
					{COLOR_ADJUST 70 0 0}
				[/then]
			[/if]
			#[remove_item]
			#	x,y=$x1,$y1
			#	halo=halo/brew-red-7.png
			#[/remove_item]
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-red-1.png}
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-red-2.png}
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-red-3.png}
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-red-4.png}
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-red-5.png}
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-red-6.png}
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-red-7.png}
			[floating_text]
				x,y=$x1,$y1
				text="<span color='green'>" + _ "Healed" + "</span>"
			[/floating_text]
			{VARIABLE_OP inventory.brew_red add -1}
			[heal_unit]
				[filter]
					side=$side_number
					canrecruit=yes
				[/filter]
				amount=$unit.hitpoints
				animate=no
				restore_statuses=yes
			[/heal_unit]
		[/then]
	[/if]
	
	# If giving the brew to Gremlock
	[if]
		[have_unit]
			x,y=$x1,$y1
			[filter_wml]
				hitpoints=$this_unit.max_hitpoints
			[/filter_wml]
			[filter_adjacent]
				id=Gremlock
				side=3
				[filter_wml]
					[status]
						poisoned=yes
					[/status]
				[/filter_wml]
			[/filter_adjacent]
		[/have_unit]
		[then]
			[message]
				speaker=unit
				message=_ "Gremlock, try some of this red brew. It should sort you out."
			[/message]
			{TAM_STORE_UNIT id="Gremlock" side=3 (
			{VARIABLE temp_x $stored_unit.x}
			{VARIABLE temp_y $stored_unit.y}
			{VARIABLE temp_amount $stored_unit.hitpoints}
			)}
			{VARIABLE finished yes}
			{PLAY_SOUND potion.ogg}
			[delay]
				time=3000
			[/delay]
			{PLAY_SOUND magic-missile-3.ogg}
			[item]
				x,y=$temp_x,$temp_y
				halo="halo/brew-red-[1,2,3,2].png:100,halo/brew-red-[3,4,5,4].png:150,halo/brew-red-[5,6,7,6,7].png:100"
			[/item]
			[delay]
				time=1500
			[/delay]
			{FLASH_RED ({PLAY_SOUND shrink.wav})}
			{TAM_REMOVE_HALO $temp_x $temp_y halo/brew-red-1.png}
			{TAM_REMOVE_HALO $temp_x $temp_y halo/brew-red-2.png}
			{TAM_REMOVE_HALO $temp_x $temp_y halo/brew-red-3.png}
			{TAM_REMOVE_HALO $temp_x $temp_y halo/brew-red-4.png}
			{TAM_REMOVE_HALO $temp_x $temp_y halo/brew-red-5.png}
			{TAM_REMOVE_HALO $temp_x $temp_y halo/brew-red-6.png}
			{TAM_REMOVE_HALO $temp_x $temp_y halo/brew-red-7.png}
			[floating_text]
				x,y=$temp_x,$temp_y
				text="<span color='green'>" + _ "Healed" + "</span>"
			[/floating_text]
			{PLACE_IMAGE items/shovel.png $temp_x $temp_y}
			{VARIABLE_OP inventory.brew_red add -1}
			[heal_unit]
				[filter]
					id=Gremlock
					side=3
				[/filter]
				amount=$temp_amount
				animate=no
				restore_statuses=yes
			[/heal_unit]
			{CLEAR_VARIABLE temp_x}
			{CLEAR_VARIABLE temp_y}
			{CLEAR_VARIABLE temp_amount}
		[/then]
	[/if]
[/command]
[/option]

# Invisibility
[option]
image=inventory/brew-blue.png
label="x$inventory.brew_blue"
description= "<span color='{TAM_BLUE}'>" + _ "Blue Brew" + "</span>"
[show_if]
	{CONDITION inventory.brew_blue greater_than_equal_to 1}
[/show_if]
[command]
	[if]
		[have_unit]
			side=$side_number
			canrecruit=yes
			[not]
				ability=tam_invisible
			[/not]
			[not]
				[filter_adjacent]
					is_enemy=yes
				[/filter_adjacent]
			[/not]
			#[not]
			#	[filter_wml]
			#		attacks_left=0
			#	[/filter_wml]
			#[/not]
			#[filter_wml]
			#	[status]
			#	[/status]
			#[/filter_wml]
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			{PLAY_SOUND potion.ogg}
			[delay]
				time=3000
			[/delay]
			{PLAY_SOUND magic-missile-3.ogg}
			[item]
				x,y=$x1,$y1
				halo="halo/brew-blue-[1,2,3,2].png:100,halo/brew-blue-[3,4,5,4].png:150,halo/brew-blue-[5,6,7,6,7].png:100"
			[/item]
			[delay]
				time=1500
			[/delay]
			{FLASH_BLUE ({PLAY_SOUND shrink.wav})}
			# Need to reinstate the screen colour in the furnace
			[if]
				{CONDITION scenario equals furnace}
				[then]
					{COLOR_ADJUST 70 0 0}
				[/then]
			[/if]
			#[remove_item]
			#	x,y=$x1,$y1
			#	halo=halo/brew-blue-7.png
			#[/remove_item]
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-blue-1.png}
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-blue-2.png}
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-blue-3.png}
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-blue-4.png}
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-blue-5.png}
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-blue-6.png}
			{TAM_REMOVE_HALO $x1 $y1 halo/brew-blue-7.png}
			[floating_text]
				x,y=$x1,$y1
				text="<span color='green'>" + _ "float^Invisible" + "</span>"
			[/floating_text]
			{VARIABLE_OP inventory.brew_blue add -1}
			{TAM_STORE_UNIT side=$side_number canrecruit=yes ({VARIABLE stored_unit.status.uncovered no})}
			{TAM_ADD_ABILITY side=$side_number canrecruit=yes {TAM_ABILITY_INVISIBLE}}
		[/then]
	[/if]
[/command]
[/option]

# Teleport
[option]
	image=inventory/brew-green.png
	label="x$inventory.brew_green"
	description= "<span color='{TAM_BLUE}'>" + _ "Green Brew" + "</span>"
	[show_if]
		{CONDITION inventory.brew_green greater_than_equal_to 1}
	[/show_if]
	[command]
		{VARIABLE finished yes}
		{PLAY_SOUND potion.ogg}
		[delay]
			time=3000
		[/delay]
		{PLAY_SOUND magic-missile-3.ogg}
		[item]
			x,y=$x1,$y1
			halo="halo/brew-green-[1~3,2].png:100,halo/brew-green-[3~5,4].png:150,halo/brew-green-[5~7,6,7].png:100"
		[/item]
		[delay]
			time=1500
		[/delay]
		{FLASH_GREEN ({PLAY_SOUND shrink.wav})}
		# Need to reinstate the screen colour in the furnace
		[if]
			{CONDITION scenario equals furnace}
			[then]
				{COLOR_ADJUST 70 0 0}
			[/then]
		[/if]
		#[remove_item]
		#	x,y=$x1,$y1
		#	image=halo/brew-green-7.png
		#[/remove_item]
		{TAM_REMOVE_HALO $x1 $y1 halo/brew-green-1.png}
		{TAM_REMOVE_HALO $x1 $y1 halo/brew-green-2.png}
		{TAM_REMOVE_HALO $x1 $y1 halo/brew-green-3.png}
		{TAM_REMOVE_HALO $x1 $y1 halo/brew-green-4.png}
		{TAM_REMOVE_HALO $x1 $y1 halo/brew-green-5.png}
		{TAM_REMOVE_HALO $x1 $y1 halo/brew-green-6.png}
		{TAM_REMOVE_HALO $x1 $y1 halo/brew-green-7.png}
		{VARIABLE_OP inventory.brew_green add -1}
		[store_unit]
			[filter]
				canrecruit=yes
				side=1,2
				[not]
					side=$side_number
				[/not]
			[/filter]
			variable=stored_unit
			kill=yes
		[/store_unit]
		[teleport]
			[filter]
				canrecruit=yes
				side=$side_number
			[/filter]
			#check_passability=yes
			x=$stored_unit.x
			y=$stored_unit.y
		[/teleport]
		{TAM_SCROLL_TO $stored_unit.x $stored_unit.y}
		[floating_text]
			x,y=$stored_unit.x,$stored_unit.y
			text="<span color='green'>" + _ "float^Teleport" + "</span>"
		[/floating_text]
		[unstore_unit]
			variable=stored_unit
			x,y=$x1,$y1
			#text= _ "float^Teleport"
			#{COLOR_HEAL}
		[/unstore_unit]
		{CLEAR_VARIABLE stored_unit}	
	[/command]
[/option]

#####################
# Cauldron
#####################

[option]
image=inventory/cauldron.png
label="x$inventory.cauldron"
description= "<span color='{TAM_BLUE}'>" + _ "Cauldron" + "</span>"
[show_if]
	{CONDITION inventory.cauldron greater_than_equal_to 1}
[/show_if]
[command]
	[message]
		speaker=unit
		message=_ "Can't do much with this cauldron right now. Best find someone who'll make the most of it."
	[/message]
[/command]
[/option]

#####################
# Clay
#####################

[option]
image=inventory/clay.png
label="x$inventory.clay"
description= "<span color='{TAM_BLUE}'>" + _ "Clay" + "</span>"
[show_if]
	{CONDITION inventory.clay greater_than_equal_to 1}
[/show_if]
[command]
	# If players use clay  on the collapsed hex after they've put the boulders in place
	[if]
		[have_unit]
			x=30
			y=4
			side=$side_number
			canrecruit=yes
		[/have_unit]
		[have_location]
			x,y=30,4
			terrain=Wwf^Dr
		[/have_location]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "This clay packs into the gaps nicely."
			[/message]
			{PLAY_SOUND squishy-strike.wav}
			{MODIFY_TERRAIN Ww 30 5}
			{MODIFY_TERRAIN Ww 31 5}
			{MODIFY_TERRAIN Ww 31 6}
			{MODIFY_TERRAIN Ww 30 8}
			{MODIFY_TERRAIN Ww 31 9}
			{TAM_REDRAW}
			{CLEAR_VARIABLE inventory.clay}
			[message]
				speaker=Hugo
				message=_ "Seems like it did the trick, for now."
			[/message]
		[/then]
	[/if]
	# If players use clay before they've put boulders on the collapsed hex
	[if]
		[have_unit]
			x=30
			y=4
			side=$side_number
			canrecruit=yes
		[/have_unit]
		[have_location]
			x,y=30,4
			terrain=Wwf
		[/have_location]
		[then]
			{VARIABLE finished yes}
			{PLAY_SOUND squishy-hit.wav}
			{CLEAR_VARIABLE inventory.clay}
			[message]
				speaker=unit
				message=_ "The water just washes the clay away. We'll need to start with something bigger."
			[/message]
		[/then]
	[/if]
	# If players use clay on the wrong hex
	[if]
		[have_unit]
			[not]
				x=30
				y=4
			[/not]
			side=$side_number
			canrecruit=yes
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "What shall we do with this clay? I don't think I need a facepack right now."
			[/message]
		[/then]
	[/if]
[/command]
[/option]


#####################
# Bomb
#####################

[option]
image=inventory/bomb.png
label="x$inventory.bomb"
description= "<span color='{TAM_BLUE}'>" + _ "Dwarven Bomb" + "</span>"
[show_if]
	{CONDITION inventory.bomb greater_than_equal_to 1}
[/show_if]
[command]
	# If they try to use the bomb on morteau before Sayer sets the quest
	[if]
		{CONDITION scenario equals morteau-c}
		{CONDITION subquest_lab less_than 2}
		[then]
			[message]
				speaker=unit
				message=_ "Our dwarven bomb might be useful here, but not right now."
			[/message]
			{VARIABLE finished yes}
		[/then]
	[/if]
	# If they try to use the bomb on morteau in the wrong place
	[if]
		{CONDITION scenario equals morteau-c}
		{CONDITION subquest_lab equals 2}
		[not]
			[have_unit]
				canrecruit=yes
				side=$side_number
				[filter_location]
					radius=2
					x,y=51,9
				[/filter_location]
			[/have_unit]
		[/not]
		[then]
			[message]
				speaker=unit
				message=_ "Let's make sure the bomb is where it needs to be before we set it off."
			[/message]
			{VARIABLE finished yes}
		[/then]
	[/if]
	# If the bomb is used in the house of pain
	[if]
		{CONDITION scenario equals morteau-c}
		{CONDITION subquest_lab equals 2}
		[have_unit]
			x,y=$x1,$y1
			side=$side_number
			[filter_location]
				radius=2
				x,y=51,9
			[/filter_location]
		[/have_unit]
		[then]
			[message]
				speaker=unit
				message=_ "Everyone stand back! I'm setting off a bomb..."
			[/message]
			{VARIABLE finished yes}
			{PLACE_IMAGE items/bomb.png $x1 $y1}
			{TAM_TELEPORT side=3 id=Sayer 44 13}
			{TAM_TELEPORT_ALL side=1 side=1 46 17}
			{TAM_TELEPORT_ALL side=2 side=2 44 16}
			{VARIABLE subquest_lab 3}
			{VARIABLE morteau d}
			{TAM_DELAY 1200}
			{QUAKE explosion.ogg}
			[item]
				x,y=$x1,$y1
				halo="projectiles/fireball-impact-1.png:60,projectiles/fireball-impact-2.png:60,projectiles/fireball-impact-3.png:60,projectiles/fireball-impact-4.png:60,projectiles/fireball-impact-5.png:60,projectiles/fireball-impact-6.png:60,projectiles/fireball-impact-7.png:60,projectiles/fireball-impact-8.png:60,projectiles/fireball-impact-9.png:60,projectiles/fireball-impact-10.png:60,projectiles/fireball-impact-11.png:60,projectiles/fireball-impact-12.png:60,projectiles/fireball-impact-13.png:60,projectiles/fireball-impact-14.png:60,projectiles/fireball-impact-15.png:60,projectiles/fireball-impact-16.png:60"
			[/item]
			{COLOR_ADJUST 67 0 0}
			{COLOR_ADJUST 100 0 0}
			[store_locations]
				terrain=Xos
				variable=tile
			[/store_locations]
			{FOREACH tile i}
				{MODIFY_TERRAIN Uh^Dr $tile[$i].x $tile[$i].y}
			{NEXT i}
			{CLEAR_VARIABLE tile}
			{MODIFY_TERRAIN Uh 48 7}
			{MODIFY_TERRAIN Uh 51 12}
			{MODIFY_TERRAIN Uh^Dr 47 8}
			{MODIFY_TERRAIN Uh^Dr 50 11}
			{MODIFY_TERRAIN Rb^Dr 52 11}
			{MODIFY_TERRAIN Rb^Dr 49 9}
			{MODIFY_TERRAIN Cud^Dr 47 7}
			{MODIFY_TERRAIN Rb 49 10}
			{MODIFY_TERRAIN Rb 50 8}
			{MODIFY_TERRAIN Rb 51 10}
			{MODIFY_TERRAIN Rb 52 9}
			{MODIFY_TERRAIN Ur 50 9}
			{MODIFY_TERRAIN Ur 51 8}
			{MODIFY_TERRAIN Ur 52 8}
			{MODIFY_TERRAIN Ur^Dr 51 9}
			{TAM_REDRAW}
			{TAM_REMOVE_IMAGE $x1 $y1}
			{TAM_REMOVE_IMAGE 49 9}
			{TAM_REMOVE_IMAGE 51 9}
			{TAM_REMOVE_IMAGE 49 10}
			{PLACE_IMAGE scenery/rubble.png 49 10}
			{PLACE_IMAGE scenery/rubble.png 49 7}
			{PLACE_IMAGE scenery/rubble.png 47 9}
			{PLACE_IMAGE scenery/rubble.png 52 8}
			{COLOR_ADJUST 33 0 0}
			{COLOR_ADJUST 0 0 0}
			{VARIABLE_OP inventory.bomb add -1}
		[/then]
	[/if]
	# If they try to use the bomb at the gaol in the wrong place
	[if]
		{CONDITION scenario equals gaol-b}
		{CONDITION subquest_gaol not_equals 1}
		[not]
			[have_unit]
				canrecruit=yes
				side=$side_number
				[filter_location]
					radius=2
					x,y=34,13
				[/filter_location]
			[/have_unit]
		[/not]
		[then]
			[message]
				speaker=unit
				message=_ "I can think of a good use for our dwarven bomb. Let's make sure we're close enough."
			[/message]
			{VARIABLE finished yes}
		[/then]
	[/if]
	# If the bomb is used in Altaz Gaol
	[if]
		{CONDITION scenario equals gaol-b}
		{CONDITION subquest_gaol not_equals 1}
		[have_unit]
			x,y=$x1,$y1
			side=$side_number
			[filter_location]
				radius=2
				x,y=34,13
			[/filter_location]
		[/have_unit]
		[then]
			[message]
				speaker=unit
				message=_ "Everyone stand back! I'm setting off a bomb..."
			[/message]
			{VARIABLE finished yes}
			{PLACE_IMAGE items/bomb.png $x1 $y1}
			{TAM_TELEPORT_ALL side=1 side=1 25 13}
			{TAM_TELEPORT_ALL side=2 side=2 25 15}
			[remove_shroud]
				side=1,2
				x=32-27
				y=12-16
			[/remove_shroud]
			{VARIABLE subquest_gaol 1}
			{TAM_DELAY 1200}
			{QUAKE explosion.ogg}
			[item]
				x,y=$x1,$y1
				halo="projectiles/fireball-impact-1.png:60,projectiles/fireball-impact-2.png:60,projectiles/fireball-impact-3.png:60,projectiles/fireball-impact-4.png:60,projectiles/fireball-impact-5.png:60,projectiles/fireball-impact-6.png:60,projectiles/fireball-impact-7.png:60,projectiles/fireball-impact-8.png:60,projectiles/fireball-impact-9.png:60,projectiles/fireball-impact-10.png:60,projectiles/fireball-impact-11.png:60,projectiles/fireball-impact-12.png:60,projectiles/fireball-impact-13.png:60,projectiles/fireball-impact-14.png:60,projectiles/fireball-impact-15.png:60,projectiles/fireball-impact-16.png:60"
			[/item]
			{COLOR_ADJUST 67 0 0}
			{COLOR_ADJUST 100 0 0}
			[store_locations]
				terrain=Xos
				variable=tile
			[/store_locations]
			{FOREACH tile i}
				{MODIFY_TERRAIN Uh^Dr $tile[$i].x $tile[$i].y}
			{NEXT i}
			{CLEAR_VARIABLE tile}
			[store_locations]
				terrain=Urb,Urb^*
				variable=tile
			[/store_locations]
			{FOREACH tile i}
				{MODIFY_TERRAIN Ur^Es $tile[$i].x $tile[$i].y}
			{NEXT i}
			{CLEAR_VARIABLE tile}
			{PLACE_IMAGE scenery/rubble.png 36 13}
			{PLACE_IMAGE scenery/rubble.png 36 14}
			{TAM_REDRAW}
			{TAM_REMOVE_IMAGE $x1 $y1}
			{TAM_REMOVE_IMAGE 33 14}
			{COLOR_ADJUST 33 0 0}
			{COLOR_ADJUST 0 0 0}
			{VARIABLE_OP inventory.bomb add -1}
			[message]
				speaker=Hugo
				message=_ "Well, that was satisfying."
			[/message]
			[message]
				speaker=Largo
				message=_ "Did I ever say how much I hated that place?"
			[/message]
			{TAM_STORE_UNIT side=1 canrecruit=yes ({VARIABLE_OP stored_unit.experience add 40})}
			[floating_text]
				[filter]
					side=1
					canrecruit=yes
				[/filter]
				text="<span color='{TAM_WHITE}'>" + _ "float^+40xp" + "</span>"
			[/floating_text]
			{TAM_STORE_UNIT side=2 canrecruit=yes ({VARIABLE_OP stored_unit.experience add 40})}
			[floating_text]
				[filter]
					side=2
					canrecruit=yes
				[/filter]
				text="<span color='{TAM_WHITE}'>" + _ "float^+40xp" + "</span>"
			[/floating_text]
			# This does nothing other than ensure they level if they exceed their max xp
			{TAM_MODIFY_MAX_EXPERIENCE side=1 canrecruit=yes 0}
			{TAM_MODIFY_MAX_EXPERIENCE side=2 canrecruit=yes 0}
		[/then]
	[/if]
	# If they try using the bomb at blade point
	[if]
		{CONDITION scenario equals blade_point}
		[have_unit]
			x,y=$x1,$y1
			side=$side_number
			[filter_location]
				radius=1
				terrain=Hh^Xo
			[/filter_location]
		[/have_unit]
		[then]
			[message]
				speaker=unit
				message=_ "The bomb would surely blow the lock apart - but it'd also bring down half the mountain!"
			[/message]
		[/then]
	[/if]
	# If they try using the bomb at the ice temple entrance
	[if]
		{CONDITION scenario equals ice_temple_above}
		[then]
			[message]
				speaker=unit
				message=_ "I'm tempted to try out the dwarven bomb right now, but it's likely to bring the roof down on the temple beneath. I don't think that's quite the entrance we want to make."
			[/message]
		[/then]
	[/if]
	# If they try using the bomb at Black Rock
	[if]
		{CONDITION scenario equals black_rock}
		[then]
			[message]
				speaker=unit
				message=_ "Using the dwarven bomb here would probably cause a cave-in. That's not what we're after."
			[/message]
		[/then]
	[/if]
	# If they try using it anywhere else
	[if]
		{CONDITION scenario not_equals morteau-c}
		{CONDITION scenario not_equals ice_temple_above}
		{CONDITION scenario not_equals blade_point}
		{CONDITION scenario not_equals gaol-b}
		{CONDITION scenario not_equals black_rock}
		[then]
			[message]
				speaker=unit
				message=_ "We'll have to wait before we can blow anything up with this dwarven bomb."
			[/message]
		[/then]
	[/if]
[/command]
[/option]

#####################
# Black blade
#####################

[option]
image=inventory/black-blade.png
label="x$inventory.black_blade"
description= "<span color='{TAM_BLUE}'>" + _ "Black Blade" + "</span>"
[show_if]
	{CONDITION inventory.black_blade greater_than_equal_to 1}
[/show_if]
[command]
	[if]
		{CONDITION scenario equals blade_point}
		[have_unit]
			x,y=$x1,$y1
			side=$side_number
			[filter_location]
				radius=1
				terrain=Hh^Xo
			[/filter_location]
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "Ah, let me try this black blade we picked up in Greystone."
			[/message]
			[message]
				speaker=unit
				message=_ "It fits the lock! The serrated edge matches the tumblers perfectly..."
			[/message]
			{VARIABLE subquest_blade 7}
			{PLAY_SOUND dart.wav}
			{MODIFY_TERRAIN Hh 32 4}
			{CLEAR_VARIABLE inventory.black_blade}
		[/then]
	[/if]
[/command]
[/option]

#####################
# Mana Orb
#####################

[option]
image=inventory/orb.png
label="x$inventory.orb"
description= "<span color='{TAM_BLUE}'>" + _ "Mana Orb" + "</span>"
[show_if]
	{CONDITION inventory.orb greater_than_equal_to 1}
[/show_if]
[command]
	[if]
		{CONDITION scenario equals world_map}
		{CONDITION log_marco.map_found equals yes}
		[have_unit]
			role=ship
			side=$side_number
			x=18-48
			y=27-33
            [filter_location]
				[filter_adjacent_location]
					terrain=Wot^Xo
				[/filter_adjacent_location]
			[/filter_location]
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			{SHHHH}
			{CUE_SILENCE}
			{PLAY_SOUND FX-Storm_Barrier_Fall.ogg}
			[message]
				speaker=unit
				message=_ "Let's see what this orb can do."
			[/message]
			[message]
				speaker=Hugo
				message=_ "It's glowing..."
			[/message]
			{TAM_DELAY 400}
			{TAM_SCROLL_TO $ship_x $ship_y}
			{TAM_DELAY 1800}
			{PLAY_SOUND lightning.ogg}
			[store_locations]
				terrain=Wot^Xo
				variable=tile
				x=$ship_x
			[/store_locations]
			{FOREACH tile i}
				[remove_item]
					x=$tile[$i].x
					y=$tile[$i].y
				[/remove_item]
				{MODIFY_TERRAIN Ww $tile[$i].x $tile[$i].y}
			{NEXT i}
			{CLEAR_VARIABLE tile}
			{VARIABLE log_storm.path yes}
			[music]
				name=TAM_Chime_at_sea.ogg
				ms_after=800
			[/music]
		[/then]
	[/if]
	
	[if]
		{CONDITION scenario equals world_map}
		{CONDITION log_marco.map_found not_equals yes}
		[have_unit]
			role=ship
			side=$side_number
			x=18-48
			y=27-30
            [filter_location]
				[filter_adjacent_location]
					terrain=Wot^Xo
				[/filter_adjacent_location]
			[/filter_location]
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "We have the orb from the temple, shall we head through the storm?"
			[/message]
			[message]
				speaker=Hugo
				message=_ "Hmm, but we don't know where we're going - and that orb might only be a one way ticket. I suggest waiting until we find out where Marco is."
			[/message]
		[/then]
	[/if]
[/command]
[/option]

#####################
# Tub
#####################

[option]
image=inventory/tub.png
label="x$inventory.tub"
description= "<span color='{TAM_BLUE}'>" + _ "Tub" + "</span>"
[show_if]
	{CONDITION inventory.tub greater_than_equal_to 1}
[/show_if]
[command]
	[if]
		{CONDITION scenario equals solant}
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "Brother, help me get this tub down to the shore. I've got an idea!"
			[/message]
			{VARIABLE ship_x 21}
			{VARIABLE ship_y 16}
			[endlevel]
				result=victory
				continue_no_save=yes
				carryover_percentage=100
				bonus=no
				carryover_report=no
				linger_mode=no
				next_scenario=meta-map
			[/endlevel]
		[/then]
	[/if]
[/command]
[/option]

#####################
# Shovel
#####################

[option]
image=inventory/shovel.png
label="x$inventory.shovel"
description= "<span color='{TAM_BLUE}'>" + _ "Shovel" + "</span>"
[show_if]
	{CONDITION inventory.shovel greater_than_equal_to 1}
[/show_if]
[command]
	# Ivory Tower
	[if]
		{CONDITION scenario equals ivory_tower}
		[have_unit]
			canrecruit=yes
			side=1,2
			x,y=30,25
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "I reckon we can clear these rocks with the shovel..."
			[/message]
			{MODIFY_TERRAIN Wwf^Do 30 25}
			{PLAY_SOUND bite.ogg}
		[/then]
	[/if]
	# Thurh Gar
	[if]
		[have_unit]
			type="Dwarvish Lord"
			name=Dharmok
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "The face of the mine is miles below ground. I could use the shovel to dig up random bits of rock up here, but I don't fancy my chances."
			[/message]
		[/then]
	[/if]
	# Black Rock
	[if]
		[have_unit]
			side=4
			name=Hilldon
		[/have_unit]
		[have_location]
			x,y=30,4
			terrain=Wwf
		[/have_location]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "Clearing this debris will only make the torrent stronger. If we're going to get to the other side we need to block it up somehow."
			[/message]
		[/then]
	[/if]
	# Ice Temple
	[if]
		{CONDITION scenario equals ice_temple_above}
		{CONDITION subquest_ice_entrance less_than 2}
		[have_location]
			x,y=$x1,$y1
			terrain=Aa
		[/have_location]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "I've got the perfect tool for shovelling snow..."
			[/message]
			{PLAY_SOUND skeleton-hit-2.ogg}
			{VARIABLE_OP inventory.snow add 1}
			{TAM_ITEM_ADDED}
		[/then]
	[/if]	
	# Black Blade tunnel
	[if]
		{CONDITION scenario equals black_blade_cavern}
		[have_unit]
			canrecruit=yes
			side=$side_number
			x=25
			y=13
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "Let's see if I can clear the rubble with our shovel..."
			[/message]
			{MODIFY_TERRAIN Ur^Es 24 13}
			{MODIFY_TERRAIN Ur^Es 25 13}
			{PLAY_SOUND bite.ogg}
			[redraw]
			[/redraw]
		[/then]
	[/if]			
	# Polupa Treasure
	[if]
		{CONDITION scenario equals polupa}
		{CONDITION subquest_polupa less_than 2}
		[have_unit]
			canrecruit=yes
			side=$side_number
			x=32
			y=5
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "I knew it! We've struck gold, brother! Help me dig up this sand..."
			[/message]
			{MODIFY_TERRAIN Ds^Esd 32 5}
			{PLAY_SOUND bite.ogg}
			[redraw]
			[/redraw]
			{CLEAR_VARIABLE inventory.map_polupa}
			{VARIABLE subquest_polupa 2}
			{PLACE_IMAGE items/chest-plain-open.png $x1 $y1}
			{TAM_SOUND open-chest.wav}
			[redraw]
			[/redraw]
			{TAM_GOLD $side_number 180}
			{PLAY_SOUND gold.ogg}
			[floating_text]
				x,y=$x1,$y1
				text="<span color='{TAM_GOLDEN}'>" + _ "float^180g" + "</span>"
			[/floating_text]
		[/then]
	[/if]		
	# The grave of Old Man Tet
	[if]
		{CONDITION scenario equals farmville-b}
		{CONDITION subquest_tet greater_than_equal_to 2}
		{CONDITION subquest_tet less_than 4}
		[have_unit]
			canrecruit=yes
			side=$side_number
			x=44
			y=12
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "This shovel might come in handy here!"
			[/message]
			[remove_item]
				x,y=$x1,$y1
				image=scenery/grave.png
			[/remove_item]
			{MODIFY_TERRAIN Dd^Es 44 12}
			{PLAY_SOUND bite.ogg}
			[redraw]
			[/redraw]
			[message]
				speaker=unit
				message=_ "Looks like Tet was buried with an almanac..."
			[/message]
			{VARIABLE subquest_tet 4}
			{VARIABLE_OP inventory.book add 1}
			{PLAY_SOUND skeleton-hit-2.ogg}
			{TAM_ITEM_ADDED}
			[message]
				canrecruit=yes
				[not]
					side=$side_number
				[/not]
				message=_ "You're digging up a grave for a rotten old book?"
			[/message]
			[object]
				id=gravedigger_curse
				silent=yes
				duration=forever
				[effect]
					apply_to=resistance
					[resistance]
						arcane=20
					[/resistance]
				[/effect]
				[effect]
					apply_to=new_ability
					[abilities]
						{TAM_CURSE_GRAVEDIGGER}
					[/abilities]
				[/effect]
			[/object]
			[floating_text]
				x,y=$x1,$y1
				text="<span color='red'>" + _ "Cursed" + "</span>"
			[/floating_text]
		[/then]
	[/if]
	# Gaddon's grave
	[if]
		{CONDITION scenario equals gaol-b}
		{CONDITION subquest_gaddon less_than 2}
		{CONDITION farrow not_equals a}
		[have_unit]
			canrecruit=yes
			side=$side_number
			x=47
			y=9
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			{VARIABLE subquest_gaddon 2}
			[message]
				speaker=unit
				message=_ "This shovel might come in handy here!"
			[/message]
			[remove_item]
				x,y=$x1,$y1
				image=scenery/grave.png
			[/remove_item]
			{MODIFY_TERRAIN Dd^Es 47 9}
			{PLAY_SOUND bite.ogg}
			[redraw]
			[/redraw]
			[message]
				speaker=unit
				message=_ "What's this? Seems Gaddon was buried in that fancy golden armour of his."
			[/message]
			{VARIABLE_OP inventory.armour add 1}
			{PLAY_SOUND skeleton-hit-2.ogg}
			{TAM_ITEM_ADDED}
			[message]
				canrecruit=yes
				[not]
					side=$side_number
				[/not]
				message=_ "We may as well take it. We put some serious dents in the breastplate, but it could still fetch a few coins."
			[/message]
			[object]
				id=gravedigger_curse
				silent=yes
				duration=forever
				[effect]
					apply_to=resistance
					[resistance]
						arcane=20
					[/resistance]
				[/effect]
				[effect]
					apply_to=new_ability
					[abilities]
						{TAM_CURSE_GRAVEDIGGER}
					[/abilities]
				[/effect]
			[/object]
			[floating_text]
				x,y=$x1,$y1
				text="<span color='red'>" + _ "Cursed" + "</span>"
			[/floating_text]
		[/then]
	[/if]
[/command]
[/option]

#####################
# Gold Armour
#####################

[option]
image=inventory/armour-gold.png
label="x$inventory.armour"
description= "<span color='{TAM_BLUE}'>" + _ "Golden Armour" + "</span>"
[show_if]
	{CONDITION inventory.armour greater_than_equal_to 1}
	[/show_if]
[command]
	[message]
		speaker=unit
		message=_ "This golden armour is real fancy and almost useless. Maybe some blacksmith can fix it up and sell it on?"
	[/message]
[/command]
[/option]

#####################
# Skull
#####################

[option]
image=inventory/skull.png
label="x$inventory.skull"
description= "<span color='{TAM_BLUE}'>" + _ "Skull" + "</span>"
[show_if]
	{CONDITION inventory.skull greater_than_equal_to 1}
[/show_if]
[command]
	[if]
		{CONDITION scenario equals tomb_inside}
		[have_unit]
			x=6
			y=5
			side=$side_number
			canrecruit=yes
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			{VARIABLE_OP inventory.skull add -1}
			[message]
				speaker=unit
				message=_ "Haha, this old skull we found would fit right on..."
			[/message]
			{PLAY_SOUND rumble.ogg}
			{SCROLL 2 1}
			{SCROLL -1 -3}
			{SCROLL -3 1}
			{SCROLL 1 3}
			{SCROLL 1 -2}
			[remove_item]
				x,y=6,2
				image=items/gohere.png
			[/remove_item]
			#[color_adjust]
			#red,green,blue=255,255,255
			#[/color_adjust]
			[store_locations]
				terrain=Zstl^Ebn,Zstl^Zbp
				variable=tile
			[/store_locations]
			{FOREACH tile i}
				{MODIFY_TERRAIN Qxu $tile[$i].x $tile[$i].y}
			{NEXT i}
			{CLEAR_VARIABLE tile}
			[redraw]
			[/redraw]
			[message]
				canrecruit=yes
				[not]
					side=$side_number
				[/not]
				message=_ "Hold on brother! The floor is crumbling! Whoah!"
			[/message]
			[message]
				speaker=unit
				message=_ "Ah! I'm sliding! I can't grab hold."
			[/message]
			{SCROLL 2 1}
			{SCROLL -1 -3}
			{SCROLL -3 1}
			{SCROLL 1 3}
			{SCROLL 1 -2}
			[store_locations]
				terrain=Zstl,Zstl^Edb
				variable=tile
			[/store_locations]
			{FOREACH tile i}
				{MODIFY_TERRAIN Qxu $tile[$i].x $tile[$i].y}
			{NEXT i}
			{CLEAR_VARIABLE tile}
			{PLAY_SOUND cave-in.ogg}
			[redraw]
			[/redraw]
			
			[endlevel]
				result=victory
				continue_no_save=yes
				carryover_percentage=100
				bonus=no
				carryover_report=no
				linger_mode=no
				next_scenario=tomb_underground
			[/endlevel]
			[/then]
		[else]
			[message]
				speaker=unit
				message=_ "What am I supposed to do with this skull? Give some sort of soliloquy? Hang on, that is what I'm doing!"
			[/message]
		[/else]
	[/if]
[/command]
[/option]

#####################
# Ankh
#####################

[option]
image=inventory/ankh.png
label="x$inventory.ankh"
description= "<span color='{TAM_BLUE}'>" + _ "Holy Ankh" + "</span>"
[show_if]
	{CONDITION inventory.ankh greater_than_equal_to 1}
[/show_if]
[command]
	# If players try using the ankh
	[message]
		speaker=unit
		message=_ "I wonder if this ankh does anything special? I can't figure it out..."
	[/message]
	[message]
		speaker=Hugo
		message=_ "Looks like it's just a worthless bit of metal."
	[/message]
[/command]
[/option]

#####################
# Flower
#####################

[option]
image=inventory/flowers.png
label="x$inventory.flower"
description= "<span color='{TAM_BLUE}'>" + _ "Flowers of Thantos" + "</span>"
[show_if]
	{CONDITION inventory.flower greater_than_equal_to 1}
[/show_if]
[command]
	# If players try using the flower
	[message]
		speaker=unit
		message=_ "These flowers from Thantos seem not to rot. Maybe they live as long as the elves themselves."
	[/message]
	[message]
		speaker=unit
		message=_ "Hang on, why am I speaking in rhyme?"
	[/message]
	[message]
		speaker=unit
		message=_ "Phew, it didn't happen that time."
	[/message]
[/command]
[/option]

#####################
# Rose Oil
#####################

[option]
image=inventory/rose-oil.png
label="x$inventory.rose_oil"
description= "<span color='{TAM_BLUE}'>" + _ "Rose Oil" + "</span>"
[show_if]
	{CONDITION inventory.rose_oil greater_than_equal_to 1}
[/show_if]
[command]
	# If players try using it
	[message]
		speaker=unit
		message=_ "This rose oil smells okay, I guess. I'm not quite sure why I bought it though."
	[/message]
[/command]
[/option]

#####################
# Egg
#####################

[option]
image=inventory/egg.png
label="x$inventory.egg"
description= "<span color='{TAM_BLUE}'>" + _ "Cockatrice Egg" + "</span>"
[show_if]
	{CONDITION inventory.egg greater_than_equal_to 1}
[/show_if]
[command]
	# If players try using it
	[message]
		speaker=unit
		message=_ "I've heard stories about people eating these cockatrice eggs, and they never end well."
	[/message]
[/command]
[/option]

#####################
# Siren's Blood
#####################

[option]
image=inventory/sirens-blood.png
label="x$inventory.sirens_blood"
description= "<span color='{TAM_BLUE}'>" + _ "Siren's Blood" + "</span>"
[show_if]
	{CONDITION inventory.sirens_blood greater_than_equal_to 1}
[/show_if]
[command]
	# If players try using it
	[if]
		[have_unit]
			x,y=$x1,$y1
			side=1,2
			canrecruit=yes
			[not]
				[filter_adjacent]
					race=naga
					is_enemy=yes
				[/filter_adjacent]
			[/not]
		[/have_unit]
		{CONDITION scenario not_equals ice_temple_above}
		[then]
			[message]
				speaker=unit
				message=_ "No way am I going to drink this siren's blood. Not after what that merchant said."
			[/message]
		[/then]
	[/if]
	# If players try using it at the ice temple
	[if]
		[have_unit]
			x,y=$x1,$y1
			side=1,2
			canrecruit=yes
		[/have_unit]
		{CONDITION scenario equals ice_temple_above}
		{CONDITION subquest_bittertooth numerical_equals 1}
		[then]
			[message]
				speaker=unit
				message=_ "I'm wary of splashing this siren's blood about... Shall we just give it to Bittertooth?"
			[/message]
		[/then]
	[/if]
	# If players use it while stood next to a level 1 naga
	[if]
		[have_unit]
			race=naga
			canrecruit=no
			level=1
			[filter_adjacent]
				x,y=$x1,$y1
				side=1,2
				is_enemy=yes
			[/filter_adjacent]
		[/have_unit]
		[then]
			[message]
				speaker=narrator
				image=wesnoth-icon.png
				sound=ink-miss.ogg
				message= _ "You uncork the flask of siren's blood and throw the contents at the naga. It recoils from the contact with the foul-smelling liquid, backs off for a moment and then becomes strangely affectionate. It seems you have a new pet."
			[/message]
			[store_unit]
				[filter]
					race=naga
					canrecruit=no
					level=1
					[filter_adjacent]
						x,y=$x1,$y1
						side=1,2
						is_enemy=yes
					[/filter_adjacent]
				[/filter]
				variable=stored_unit
			[/store_unit]
			{VARIABLE stored_unit.side $side_number}
			[unstore_unit]
				variable=stored_unit
			[/unstore_unit]
			{CLEAR_VARIABLE stored_unit}
			{VARIABLE_OP inventory.sirens_blood add -1}
			{VARIABLE finished yes}
		[/then]
	[/if]
	# If players use it while stood next to a level 2-5 naga
	[if]
		[have_unit]
			race=naga
			canrecruit=no
			level=2,3,4,5
			[not]
				level=1
			[/not]
			[filter_adjacent]
				x,y=$x1,$y1
				side=1,2
				is_enemy=yes
			[/filter_adjacent]
		[/have_unit]
		[then]
			[message]
				speaker=unit
				message=_ "I don't think this siren's blood is going to work on a creature of this size."
			[/message]
			{VARIABLE finished yes}
		[/then]
	[/if]
[/command]
[/option]

#####################
# Snow
#####################

[option]
image=inventory/snow.png
label="x$inventory.snow"
description= "<span color='{TAM_BLUE}'>" + _ "Snow" + "</span>"
[show_if]
	{CONDITION inventory.snow greater_than_equal_to 1}
[/show_if]
[command]
	# If players use snow on rock3 again
	[if]
		{CONDITION scenario equals ice_temple_above}
		[have_unit]
			x=36
			y=12
			side=$side_number
			canrecruit=yes
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "I could put some snow on top of a snowy rock, but I'd rather do something else."
			[/message]
		[/then]
	[/if]
	# If players use snow on rock1 again
	[if]
		{CONDITION scenario equals ice_temple_above}
		{CONDITION temp_rock1 equals yes}
		[have_unit]
			x=34
			y=9
			side=$side_number
			canrecruit=yes
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "I could try putting more snow here, but it wouldn't make any difference."
			[/message]
		[/then]
	[/if]
	# If players use snow on rock1 first time
	[if]
		{CONDITION scenario equals ice_temple_above}
		{CONDITION temp_rock1 not_equals yes}
		[have_unit]
			x=34
			y=9
			side=$side_number
			canrecruit=yes
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "I'm not sure why, but I'm going try coating this rock with the snow we picked up."
			[/message]
			{PLAY_SOUND entangle.wav}
			[remove_item]
				x=$x1
				y=$y1
			[/remove_item]
			{PLACE_IMAGE scenery/rock1-snow.png 34 9}
			{VARIABLE_OP inventory.snow add -1}
			{VARIABLE temp_rock1 yes}
		[/then]
	[/if]
	# If players use snow on rock4 again
	[if]
		{CONDITION scenario equals ice_temple_above}
		{CONDITION temp_rock4 equals yes}
		[have_unit]
			x=32
			y=12
			side=$side_number
			canrecruit=yes
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "I don't think putting any more snow on this rock would change much."
			[/message]
		[/then]
	[/if]
	# If players use snow on rock4 first time
	[if]
		{CONDITION scenario equals ice_temple_above}
		{CONDITION temp_rock4 not_equals yes}
		[have_unit]
			x=32
			y=12
			side=$side_number
			canrecruit=yes
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			[message]
				speaker=unit
				message=_ "This snow we picked up is melting, might as well put it down here."
			[/message]
			{PLAY_SOUND entangle.wav}
			[remove_item]
				x=$x1
				y=$y1
			[/remove_item]
			{PLACE_IMAGE scenery/rock4-snow.png 32 12}
			{VARIABLE_OP inventory.snow add -1}
			{VARIABLE temp_rock4 yes}
		[/then]
	[/if]
[/command]
[/option]

#####################
# Crystaline Vial
#####################

[option]
image=inventory/crystaline-vial.png
label="x$inventory.crystaline_vial"
description= "<span color='{TAM_BLUE}'>" + _ "Crystaline Vial" + "</span>"
[show_if]
	{CONDITION inventory.crystaline_vial greater_than_equal_to 1}
[/show_if]
[command]
	# If players try it whilst in water
	[if]
		[have_unit]
			canrecruit=yes
			side=$side_number
            [filter_location]
				terrain=Wwg,Ww,Wwt,Wwf,Wwrg,Wwr,Wwrt,Ww^Erf
			[/filter_location]
		[/have_unit]
		[then]
			[message]
				speaker=unit
				message=_ "I guess I could fill up this crystaline vial with water - but we could use a bucket for that. The merchant seemed to think it could be used for something special."
			[/message]
		[/then]
	[/if]
	# If players try it anywhere else (except on elixion)
	[if]
		{CONDITION scenario not_equals elixion}
		[have_unit]
			canrecruit=yes
			side=$side_number
			[not]
				[filter_location]
					terrain=Wwg,Ww,Wwt,Wwf,Wwrg,Wwr,Wwrt,Ww^Erf,Ww^Ewf
				[/filter_location]
			[/not]
		[/have_unit]
		[then]
			[message]
				speaker=unit
				message=_ "What am I to do with this empty vial we bought? I think we've been had."
			[/message]
		[/then]
	[/if]	
	# If players try it on the fountain of elixion
	[if]
		{CONDITION scenario equals elixion}
		[have_unit]
			canrecruit=yes
			side=$side_number
			x=43
			y=25
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			
			# The dialogue should only happen first time
			[if]
			{CONDITION subquest_trees less_than_equal_to 1}
				[then]
					[message]
						speaker=unit
						message=_ "This crytaline vial seems perfect for scooping up some of this fountain water."
					[/message]
					{TAM_ITEM_ADDED}
					{VARIABLE_OP inventory.crystaline_vial add -1}
					{VARIABLE_OP inventory.elixir add 3}
					[message]
						speaker=Mikal
						message=_ "Indeed, no other vessel could contain these waters."
					[/message]
					[message]
						speaker=unit
						message=_ "Interesting. Seems there's enough in the vial for three gulps."
					[/message]
					[message]
						speaker=Mikal
						message=_ "None should drink the elixir! Its powers are too profound. You may bathe in it safely, but imbibing the water would multiply the magic many times. I fear you would be restored to a former state of being which you would not find... helpful."
					[/message]
				[/then]
				[else]
					{TAM_ITEM_ADDED}
					{VARIABLE_OP inventory.crystaline_vial add -1}
					{VARIABLE_OP inventory.elixir add 3}
				[/else]
			[/if]
			
		[/then]
	[/if]
[/command]
[/option]

#####################
# Elixir
#####################

[option]
image=inventory/elixir.png
label="x$inventory.elixir"
description= "<span color='{TAM_BLUE}'>" + _ "Elixir" + "</span>"
[show_if]
	{CONDITION inventory.elixir greater_than_equal_to 1}
[/show_if]
[command]
	# If players try using it during the Ivory Tower battle
	[if]
		{CONDITION scenario equals ivory_tower_battle}
		[then]
			[message]
				speaker=unit
				message=_ "There's no time for messing around with this elixir right now. Let's come back to that."
			[/message]
		[/then]
	[/if]
	# If players try using it on a dead tree by the Ivory Tower
	[if]
		{CONDITION scenario equals ivory_tower}
		[have_unit]
			canrecruit=yes
			side=$side_number
			[filter_location]
				terrain=Gd^Fetd
			[/filter_location]
		[/have_unit]
		[then]
			# Store the tree hex so it can be converted to a living tree when the map is reloaded
			[store_locations]
				x,y=$x1,$y1
				variable=ivory_trees_xy
				[or]
					find_in=ivory_trees_xy
				[/or]
			[/store_locations]
			{VARIABLE finished yes}
			# When they revive them all
			[if]
			{CONDITION subquest_trees numerical_equals 6}
				[then]
					{VARIABLE_OP inventory.elixir add -1}
					{VARIABLE_OP subquest_trees add 1}
					{PLAY_SOUND wose-die.ogg}
					{MODIFY_TERRAIN Gg^Fet $x1 $y1}
					[message]
						speaker=Dylii
						message=_ "The forest is regrown! Come speak with me, men of miracles."
					[/message]
				[/then]
			[/if]
			# If they've revived one already, but not all
			[if]
			{CONDITION subquest_trees greater_than_equal_to 2}
			{CONDITION subquest_trees less_than_equal_to 6}
				[then]
					{VARIABLE_OP inventory.elixir add -1}
					{VARIABLE_OP subquest_trees add 1}
					{PLAY_SOUND wose-die.ogg}
					{MODIFY_TERRAIN Gg^Fet $x1 $y1}
				[/then]
			[/if]
			# If it's the first tree they've revived
			[if]
			{CONDITION subquest_trees less_than_equal_to 1}
				[then]
					[message]
						speaker=unit
						message=_ "I'm tempted to test out the elixir we picked up on these dead trees."
					[/message]
					{VARIABLE_OP inventory.elixir add -1}
					{VARIABLE subquest_trees 2}
					{PLAY_SOUND wose-die.ogg}
					{MODIFY_TERRAIN Gg^Fet $x1 $y1}
					[message]
						speaker=unit
						message=_ "Whoah!"
					[/message]
					[message]
						speaker=Dylii
						message=_ "It is a marvel! The tree of the forest lives once more!"
					[/message]
				[/then]
			[/if]
		[/then]
		
		# If players try it anywhere else
		[else]
			[message]
				speaker=unit
				message=_ "I'm itching to use this elixir we've got, but that elf gave us a stern warning. I reckon it's too potent to drink. In any case, I'm not gonna risk it."
			[/message]
		[/else]
	[/if]	
	
[/command]
[/option]

####################################################################################
# Keys
####################################################################################

# Lord Rue's Key
[option]
image=inventory/key-gold.png
label="x$inventory.key_tomb"
description= "<span color='{TAM_BLUE}'>" + _ "Tomb Key" + "</span>"
[show_if]
	{CONDITION inventory.key_tomb greater_than_equal_to 1}
[/show_if]
[command]
	[if]
		{CONDITION scenario equals tomb_underground}
		[have_unit]
			canrecruit=yes
			side=$side_number
			x,y=11,34
		[/have_unit]
		[then]
			{VARIABLE finished yes}
			{VARIABLE_OP inventory.key_tomb add -1}
			{TAM_SOUND open-chest.wav}
			[remove_item]
			  x,y=$x1,$y1
			  image=items/chest-plain-closed.png
			[/remove_item]
			{PLACE_IMAGE items/chest-plain-open.png $x1 $y1}
			[redraw]
			[/redraw]
			[message]
				speaker=unit
				message=_ "Whoah, look what we have here!"
			[/message]
			{TAM_GOLD $side_number 200}
			{PLAY_SOUND gold.ogg}
			[floating_text]
				x,y=$x1,$y1
				text="<span color='{TAM_GOLDEN}'>" + _ "float^200g" + "</span>"
			[/floating_text]
		[/then]
	[/if]
[/command]
[/option]

# Morteau's Key
[option]
image=inventory/key-silver.png
label="x$inventory.key_morteau"
description= "<span color='{TAM_BLUE}'>" + _ "Morteau's Key" + "</span>"
[show_if]
	{CONDITION inventory.key_morteau greater_than_equal_to 1}
[/show_if]
[command]
[/command]
[/option]

# Royal Bedroom Key
[option]
image=inventory/key-gold.png
label="x$inventory.key_royal_bedroom"
description= "<span color='{TAM_BLUE}'>" + _ "Palace Bedroom Key" + "</span>"
[show_if]
	{CONDITION inventory.key_royal_bedroom greater_than_equal_to 1}
[/show_if]
[command]
[/command]
[/option]

# Royal Library Key
[option]
image=inventory/key-gold.png
label="x$inventory.key_royal_library"
description= "<span color='{TAM_BLUE}'>" + _ "Palace Library Key" + "</span>"
[show_if]
	{CONDITION inventory.key_royal_library greater_than_equal_to 1}
[/show_if]
[command]
[/command]
[/option]

# Royal Treasury Key
[option]
image=inventory/key-gold.png
label="x$inventory.key_royal_treasury"
description= "<span color='{TAM_BLUE}'>" + _ "Palace Treasury Key" + "</span>"
[show_if]
	{CONDITION inventory.key_royal_treasury greater_than_equal_to 1}
[/show_if]
[command]
[/command]
[/option]

# Solant Key
[option]
image=inventory/key-silver.png
label="x$inventory.key_solant_tower"
description= "<span color='{TAM_BLUE}'>" + _ "Solant Tower Key" + "</span>"
[show_if]
	{CONDITION inventory.key_solant_tower greater_than_equal_to 1}
[/show_if]
[command]
[/command]
[/option]

# Temple Of Ice Storeoom Key
[option]
image=inventory/key-blue.png
label="x$inventory.key_ice"
description= "<span color='{TAM_BLUE}'>" + _ "Temple Of Ice Key" + "</span>"
[show_if]
	{CONDITION inventory.key_ice greater_than_equal_to 1}
[/show_if]
[command]
[/command]
[/option]

# Ivory Tower Dorm Key
[option]
image=inventory/key-silver.png
label="x$inventory.key_dorm"
description= "<span color='{TAM_BLUE}'>" + _ "Ivory Tower Dormitory Key" + "</span>"
[show_if]
	{CONDITION inventory.key_dorm greater_than_equal_to 1}
[/show_if]
[command]
[/command]
[/option]

# Fort Liberty Throne Room Cell Key
[option]
image=inventory/key-gold.png
label="x$inventory.key_throne_room_cell"
description= "<span color='{TAM_BLUE}'>" + _ "Throne Room Cell Key" + "</span>"
[show_if]
	{CONDITION inventory.key_throne_room_cell greater_than_equal_to 1}
[/show_if]
[command]
[/command]
[/option]

####################################################################################
# Scrolls & Books
####################################################################################

# Books
[option]
image=inventory/book.png
label="x$inventory.book"
description= "<span color='{TAM_BLUE}'>" + _ "Book" + "</span>"
[show_if]
	{CONDITION inventory.book greater_than_equal_to 1}
[/show_if]
[command]
	[message]
		speaker=unit
		message=_ "I haven't got the time to read a book right now. Besides, I can't read."
	[/message]
[/command]
[/option]

# Crow's Scroll
[option]
image=inventory/scroll-black.png
label="x$inventory.scroll_crow"
description= "<span color='{TAM_BLUE}'>" + _ "Crow's Scroll" + "</span>"
[show_if]
	{CONDITION inventory.scroll_crow greater_than_equal_to 1}
[/show_if]
[command]
	[if]
		{CONDITION scenario equals ivory_tower1}
		[or]
			{CONDITION scenario equals ivory_tower2}
		[/or]
		[then]
			[message]
				speaker=unit
				message=_ "Do you want this scroll? Someone called Crow gave it to us."
			[/message]
			[message]
				type=TAM_Librarian
				message=_ "That is of no use to us. Next time bring a book, not just a scrap of parchment."
			[/message]
			{VARIABLE finished yes}
		[/then]
		[else]
			[message]
				speaker=unit
				message=_ "I better not break the seal on this scroll that Crow gave us."
			[/message]
		[/else]
	[/if]
[/command]
[/option]

# Polupa Treasure Map
[option]
image=inventory/map-treasure.png
label="x$inventory.map_polupa"
description= "<span color='{TAM_BLUE}'>" + _ "Polupa Treasure Map" + "</span>"
[show_if]
	{CONDITION inventory.map_polupa greater_than_equal_to 1}
[/show_if]
[command]
	[message]
		speaker=narrator
		image=misc/scroll.png
		message= _ "Find the tree with the double notch and take two steps north."
	[/message]
[/command]
[/option]

# Icewind's Scroll
[option]
image=inventory/scroll-blue.png
label="x$inventory.scroll_icewind"
description= "<span color='{TAM_BLUE}'>" + _ "Ice Scroll" + "</span>"
[show_if]
	{CONDITION inventory.scroll_icewind greater_than_equal_to 1}
[/show_if]
[command]
	[if]
		{CONDITION scenario equals ivory_tower1}
		[or]
			{CONDITION scenario equals ivory_tower2}
		[/or]
		[then]
			[message]
				speaker=unit
				message=_ "Do you want this scroll? We found it in the Ice Temple."
			[/message]
			[message]
				type=TAM_Librarian
				message=_ "Of course not. Bring us a tome of some worth not just an old parchment."
			[/message]
			{VARIABLE finished yes}
		[/then]
		[else]
			[message]
				speaker=unit
				message=_ "I better not break the seal on this scroll. Maybe Icewind wants it."
			[/message]
		[/else]
	[/if]
[/command]
[/option]

# Scroll of Honour
[option]
image=inventory/scroll-green.png
label="x$inventory.scroll_honour"
description= "<span color='{TAM_BLUE}'>" + _ "Scroll of Honour" + "</span>"
[show_if]
	{CONDITION inventory.scroll_honour greater_than_equal_to 1}
[/show_if]
[command]
[/command]
[/option]





[/message]
[/do]
[/while]

[/command]
[/set_menu_item] 
#enddef
